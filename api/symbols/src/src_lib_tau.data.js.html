<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <link rel=stylesheet href="../../code.css" type="text/css"></head><body><pre><span class='linenumber'>   1</span> <span class="COMM">/*
<span class='linenumber'>   2</span>    Copyright (c) 2012 KT Corp.
<span class='linenumber'>   3</span>   
<span class='linenumber'>   4</span>    This program is free software: you can redistribute it and/or modify
<span class='linenumber'>   5</span>    it under the terms of the GNU Lesser General Public License as published by
<span class='linenumber'>   6</span>    the Free Software Foundation, either version 3 of the License, or
<span class='linenumber'>   7</span>    (at your option) any later version.
<span class='linenumber'>   8</span> 
<span class='linenumber'>   9</span>    This program is distributed in the hope that it will be useful,
<span class='linenumber'>  10</span>    but WITHOUT ANY WARRANTY; without even the implied warranty of
<span class='linenumber'>  11</span>    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<span class='linenumber'>  12</span>    GNU Lesser General Public License for more details.
<span class='linenumber'>  13</span> 
<span class='linenumber'>  14</span>    You should have received a copy of the GNU Lesser General Public License
<span class='linenumber'>  15</span>    along with This program.  If not, see &lt;http://www.gnu.org/licenses/>.
<span class='linenumber'>  16</span> */</span><span class="WHIT">
<span class='linenumber'>  17</span> </span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">global</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  18</span> 
<span class='linenumber'>  19</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>  20</span>        * Request option context maker.
<span class='linenumber'>  21</span>        * @private
<span class='linenumber'>  22</span>        * @param {Object} opts Request options
<span class='linenumber'>  23</span>        * @returns {Object} Request context
<span class='linenumber'>  24</span>        */</span><span class="WHIT">
<span class='linenumber'>  25</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_createRequestOpts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  26</span> </span><span class="WHIT">        </span><span class="NAME">opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  27</span> </span><span class="WHIT">          </span><span class="COMM">// Default Request Options</span><span class="WHIT">
<span class='linenumber'>  28</span> </span><span class="WHIT">          </span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'GET'</span><span class="PUNC">,</span><span class="WHIT">              </span><span class="COMM">// 'GET', 'POST', 'JSONP'</span><span class="WHIT">
<span class='linenumber'>  29</span> </span><span class="WHIT">          </span><span class="NAME">contentType</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'application/x-www-form-urlencoded'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>  30</span> </span><span class="WHIT">          </span><span class="NAME">encoding</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'UTF-8'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>  31</span> </span><span class="WHIT">          </span><span class="NAME">async</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>  32</span> </span><span class="WHIT">          </span><span class="NAME">timeout</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5000</span><span class="PUNC">,</span><span class="WHIT">            </span><span class="COMM">// Default timeout is 5 seconds</span><span class="WHIT">
<span class='linenumber'>  33</span> </span><span class="WHIT">          </span><span class="NAME">silent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">            </span><span class="COMM">// Does not fire system events</span><span class="WHIT">
<span class='linenumber'>  34</span> </span><span class="WHIT">          </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT">                   </span><span class="COMM">// URL used to send the request</span><span class="WHIT">
<span class='linenumber'>  35</span> </span><span class="WHIT">          </span><span class="COMM">/** @param {String} params Parameters used by POST request */</span><span class="WHIT">
<span class='linenumber'>  36</span> </span><span class="WHIT">          </span><span class="COMM">/** @param {String} username User name for an authentication */</span><span class="WHIT">
<span class='linenumber'>  37</span> </span><span class="WHIT">          </span><span class="COMM">/** @param {String} password Password for an authentication */</span><span class="WHIT">
<span class='linenumber'>  38</span> </span><span class="WHIT">          </span><span class="COMM">/** @param {String} callbackParam JSONP callback param key */</span><span class="WHIT">
<span class='linenumber'>  39</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  40</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  41</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>  42</span> 
<span class='linenumber'>  43</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>  44</span>        * Creates equest timeout handler.
<span class='linenumber'>  45</span>        * &lt;p/>
<span class='linenumber'>  46</span>        * Timeout callback handled via request ctx.responseProxy.
<span class='linenumber'>  47</span>        * @private
<span class='linenumber'>  48</span>        * @param {Object} ctx Request context
<span class='linenumber'>  49</span>        * @returns {Number} Timer id if the timeout was set, undefined otherwise
<span class='linenumber'>  50</span>        */</span><span class="WHIT">
<span class='linenumber'>  51</span> </span><span class="WHIT">      </span><span class="NAME">_createTimeout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  52</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.timeout</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  53</span> </span><span class="WHIT">          </span><span class="COMM">/** Request timed out, notify callback handler 
<span class='linenumber'>  54</span>            * @inner */</span><span class="WHIT">
<span class='linenumber'>  55</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  56</span> </span><span class="WHIT">            </span><span class="COMM">// Timeout Error call by passing in an error response</span><span class="WHIT">
<span class='linenumber'>  57</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">ctx.responseProxy</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  58</span> </span><span class="WHIT">              </span><span class="NAME">ctx.responseProxy</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">(</span><span class="NUMB">408</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Client Request Timeout'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  59</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  60</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.timeout</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  61</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  62</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  63</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>  64</span> 
<span class='linenumber'>  65</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>  66</span>        * Notifies a runtime system event.
<span class='linenumber'>  67</span>        * @private
<span class='linenumber'>  68</span>        * @param {Object} ctx Request context
<span class='linenumber'>  69</span>        * @param {String} eventName Event name
<span class='linenumber'>  70</span>        */</span><span class="WHIT">
<span class='linenumber'>  71</span> </span><span class="WHIT">      </span><span class="NAME">_fireSysEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eventName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  72</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ctx.silent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  73</span> </span><span class="WHIT">          </span><span class="NAME">tau.getRuntime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">fireEvent</span><span class="PUNC">(</span><span class="NAME">eventName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  74</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  75</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>  76</span> 
<span class='linenumber'>  77</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>  78</span>        * @class
<span class='linenumber'>  79</span>        * A response corresponding to a XML/XSS/Proxy request.
<span class='linenumber'>  80</span>        * @constructs
<span class='linenumber'>  81</span>        * @private
<span class='linenumber'>  82</span>        * @param {Number} status Request status
<span class='linenumber'>  83</span>        * @param {String} statusText Status in string
<span class='linenumber'>  84</span>        * @param {String} contType Content type (e.g. html/text)
<span class='linenumber'>  85</span>        * @param {String} respText Content in text
<span class='linenumber'>  86</span>        * @param {String} respXML Content in XML
<span class='linenumber'>  87</span>        */</span><span class="WHIT">
<span class='linenumber'>  88</span> </span><span class="WHIT">      </span><span class="NAME">_Response</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">status</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">statusText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">contType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">respText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">respXML</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  89</span> </span><span class="WHIT">        </span><span class="NAME">this.status</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">status</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  90</span> </span><span class="WHIT">        </span><span class="NAME">this.statusText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">statusText</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  91</span> </span><span class="WHIT">        </span><span class="NAME">this.contentType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  92</span> </span><span class="WHIT">        </span><span class="NAME">this.responseText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">respText</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  93</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contType</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">contType.indexOf</span><span class="PUNC">(</span><span class="STRN">'application/json'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  94</span> </span><span class="WHIT">          </span><span class="NAME">this.responseJSON</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.isString</span><span class="PUNC">(</span><span class="NAME">respText</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">tau.parse</span><span class="PUNC">(</span><span class="NAME">respText</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">respText</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  95</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  96</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">respXML</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  97</span> </span><span class="WHIT">            </span><span class="NAME">respXML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DOMParser</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parseFromString</span><span class="PUNC">(</span><span class="NAME">respText</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  98</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  99</span> </span><span class="WHIT">          </span><span class="NAME">this.responseXML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">respXML</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 100</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 101</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 102</span> 
<span class='linenumber'> 103</span> 
<span class='linenumber'> 104</span> </span><span class="WHIT">  </span><span class="COMM">/** @lends tau.data.XMLRequest */</span><span class="WHIT">
<span class='linenumber'> 105</span> </span><span class="WHIT">  </span><span class="NAME">$class</span><span class="PUNC">(</span><span class="STRN">'tau.data.XMLRequest'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">define</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 106</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 107</span>      * @class
<span class='linenumber'> 108</span>      * XMLHttpRequest wrapped request helper.
<span class='linenumber'> 109</span>      * &lt;p/>
<span class='linenumber'> 110</span>      * System Events Fired:
<span class='linenumber'> 111</span>      * &lt;pre>
<span class='linenumber'> 112</span>      *  Request sent: "requestsent" (tau.rt.Event.REQ_SENT)
<span class='linenumber'> 113</span>      *  Request received: "requestreceived" (tau.rt.Event.REQ_RECEIVED)
<span class='linenumber'> 114</span>      *  Request aborted: "requestaborted" (tau.rt.Event.REQ_ABORTED)
<span class='linenumber'> 115</span>      * &lt;/pre>
<span class='linenumber'> 116</span>      * @constructs
<span class='linenumber'> 117</span>      */</span><span class="WHIT">
<span class='linenumber'> 118</span> </span><span class="WHIT">    </span><span class="NAME">XMLRequest</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 119</span> </span><span class="WHIT">      </span><span class="COMM">/** @private Default options */</span><span class="WHIT">
<span class='linenumber'> 120</span> </span><span class="WHIT">      </span><span class="NAME">this._opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_createRequestOpts</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 121</span> </span><span class="WHIT">      </span><span class="COMM">/** @private Maps request id to per XMLRequest instance */</span><span class="WHIT">
<span class='linenumber'> 122</span> </span><span class="WHIT">      </span><span class="NAME">this._registry</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 123</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 124</span> 
<span class='linenumber'> 125</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 126</span>      * Sends a request using XMLHttpRequest.
<span class='linenumber'> 127</span>      * @param {String} url URL to send the 
<span class='linenumber'> 128</span>      * @param {Function} callbackFn Request success/fail callback function
<span class='linenumber'> 129</span>      * @param {Object} opts Overrideable request options
<span class='linenumber'> 130</span>      * @returns {String} Request id
<span class='linenumber'> 131</span>      */</span><span class="WHIT">
<span class='linenumber'> 132</span> </span><span class="WHIT">    </span><span class="NAME">send</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callbackFn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 133</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 134</span> </span><span class="WHIT">          </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 135</span> </span><span class="WHIT">        </span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.genId</span><span class="PUNC">(</span><span class="STRN">'xml'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 136</span> </span><span class="WHIT">        </span><span class="NAME">req</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 137</span> </span><span class="WHIT">        </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 138</span> </span><span class="WHIT">        </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.isString</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 139</span> </span><span class="WHIT">        </span><span class="NAME">callbackFn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">callbackFn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">callbackFn</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 140</span> 
<span class='linenumber'> 141</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='linenumber'> 142</span>          * Handles both XHR state changes and native response errors.
<span class='linenumber'> 143</span>          * (will be assigned to XMLHttpRequest.XHR.onreadystatechange)
<span class='linenumber'> 144</span>          * &lt;p/>
<span class='linenumber'> 145</span>          * Note: client-aborted requests must not be handled here because 
<span class='linenumber'> 146</span>          * aborted request must not call the &lt;code>callbackFn&lt;/code>.
<span class='linenumber'> 147</span>          * @inner
<span class='linenumber'> 148</span>          * @param {Object} event XHR request or error Response
<span class='linenumber'> 149</span>          */</span><span class="WHIT">
<span class='linenumber'> 150</span> </span><span class="WHIT">        </span><span class="NAME">responseProxy</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 151</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 152</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.req</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 153</span> </span><span class="WHIT">              </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.req.readyState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 154</span> </span><span class="WHIT">            </span><span class="NAME">ctx.req.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Avoid timeout race condition </span><span class="WHIT">
<span class='linenumber'> 155</span> 
<span class='linenumber'> 156</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">event</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 157</span> </span><span class="WHIT">              </span><span class="COMM">// Error initiated by the client: abort XHR</span><span class="WHIT">
<span class='linenumber'> 158</span> </span><span class="WHIT">              </span><span class="NAME">ctx.req.abort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 159</span> </span><span class="WHIT">              </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 160</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 161</span> </span><span class="WHIT">              </span><span class="COMM">// Successfully received response via XHR (status: 200 - 299)</span><span class="WHIT">
<span class='linenumber'> 162</span> </span><span class="WHIT">              </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">(</span><span class="NAME">ctx.req.status</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.req.statusText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 163</span> </span><span class="WHIT">                            </span><span class="NAME">ctx.req.getResponseHeader</span><span class="PUNC">(</span><span class="STRN">'Content-Type'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 164</span> </span><span class="WHIT">                            </span><span class="NAME">ctx.req.responseText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.req.responseXML</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 165</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 166</span> </span><span class="WHIT">            </span><span class="NAME">tau.log.debug</span><span class="PUNC">(</span><span class="STRN">'status: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">resp.statusText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">that</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 167</span> 
<span class='linenumber'> 168</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">ctx.callbackFn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 169</span> </span><span class="WHIT">              </span><span class="NAME">ctx.callbackFn</span><span class="PUNC">(</span><span class="NAME">resp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// Client callback with native response</span><span class="WHIT">
<span class='linenumber'> 170</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 171</span> 
<span class='linenumber'> 172</span> </span><span class="WHIT">            </span><span class="NAME">ctx.release</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 173</span> </span><span class="WHIT">            </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_RECEIVED</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 174</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 175</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 176</span> 
<span class='linenumber'> 177</span> </span><span class="WHIT">        </span><span class="COMM">/** Releases all of the request resource for this closure. 
<span class='linenumber'> 178</span>          * @inner */</span><span class="WHIT">
<span class='linenumber'> 179</span> </span><span class="WHIT">        </span><span class="NAME">release</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 180</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.timeoutId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 181</span> </span><span class="WHIT">            </span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">ctx.timeoutId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 182</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 183</span> </span><span class="WHIT">          </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">that._registry</span><span class="PUNC">[</span><span class="NAME">ctx.id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 184</span> </span><span class="WHIT">          </span><span class="NAME">ctx.req</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Prevent closure memory leak on onreadystatechange</span><span class="WHIT">
<span class='linenumber'> 185</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 186</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._opts</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 187</span> </span><span class="WHIT">      </span><span class="NAME">ctx.req.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.responseProxy</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 188</span> 
<span class='linenumber'> 189</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.async</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 190</span> </span><span class="WHIT">        </span><span class="NAME">this._registry</span><span class="PUNC">[</span><span class="NAME">ctx.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Async request registration</span><span class="WHIT">
<span class='linenumber'> 191</span> </span><span class="WHIT">        </span><span class="NAME">ctx.timeoutId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_createTimeout</span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 192</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 193</span> 
<span class='linenumber'> 194</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">document.URL.indexOf</span><span class="PUNC">(</span><span class="STRN">'http://'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 195</span> </span><span class="WHIT">        </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'Under original scheme of \''</span><span class="WHIT">
<span class='linenumber'> 196</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">document.URL.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">document.URL.indexOf</span><span class="PUNC">(</span><span class="STRN">':'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'> 197</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'\' your request can not be handled as XHR: '</span><span class="WHIT">
<span class='linenumber'> 198</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ctx.url</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.currentStack</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 199</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 200</span> </span><span class="WHIT">      </span><span class="COMM">// Send XHR request</span><span class="WHIT">
<span class='linenumber'> 201</span> </span><span class="WHIT">      </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 202</span> </span><span class="WHIT">        </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_SENT</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 203</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.url.indexOf</span><span class="PUNC">(</span><span class="STRN">'http://'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 204</span> </span><span class="WHIT">            </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ctx.url.indexOf</span><span class="PUNC">(</span><span class="STRN">'http://'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">document.domain</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 205</span> </span><span class="WHIT">          </span><span class="NAME">ctx.referer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.url</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// tunnel proxy</span><span class="WHIT">
<span class='linenumber'> 206</span> </span><span class="WHIT">          </span><span class="NAME">ctx.url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="STRN">'./proxy'</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 207</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 208</span> </span><span class="WHIT">        </span><span class="NAME">ctx.req.open</span><span class="PUNC">(</span><span class="NAME">ctx.type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.async</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.username</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.password</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 209</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.referer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 210</span> </span><span class="WHIT">          </span><span class="NAME">ctx.req.setRequestHeader</span><span class="PUNC">(</span><span class="STRN">'x-tau-uri'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.referer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 211</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 212</span> </span><span class="WHIT">        </span><span class="NAME">ctx.req.setRequestHeader</span><span class="PUNC">(</span><span class="STRN">'Content-type'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.contentType</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 213</span> </span><span class="WHIT">        </span><span class="NAME">ctx.req.send</span><span class="PUNC">(</span><span class="NAME">ctx.type.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'GET'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 214</span> </span><span class="WHIT">						</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.url</span><span class="PUNC">(</span><span class="NAME">ctx.url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.params</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">query</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 215</span> 
<span class='linenumber'> 216</span> </span><span class="WHIT">        </span><span class="COMM">// Synchronous response can do callback immediately after</span><span class="WHIT">
<span class='linenumber'> 217</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ctx.async</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 218</span> </span><span class="WHIT">          </span><span class="NAME">ctx.callbackFn</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">(</span><span class="NAME">ctx.req.status</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.req.statusText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 219</span> </span><span class="WHIT">                          </span><span class="NAME">ctx.req.getResponseHeader</span><span class="PUNC">(</span><span class="STRN">'Content-Type'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 220</span> </span><span class="WHIT">                          </span><span class="NAME">ctx.req.responseText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.req.responseXML</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 221</span> </span><span class="WHIT">          </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_RECEIVED</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 222</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 223</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 224</span> </span><span class="WHIT">        </span><span class="COMM">// Notify error to client (request abort done in responseProxy)</span><span class="WHIT">
<span class='linenumber'> 225</span> </span><span class="WHIT">        </span><span class="NAME">ctx.responseProxy</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">(</span><span class="NUMB">400</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ex.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ex.code</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'): '</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 226</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ex.message</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 227</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 228</span> 
<span class='linenumber'> 229</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 230</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 231</span> 
<span class='linenumber'> 232</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 233</span>      * Aborts a request previously sent using its id.
<span class='linenumber'> 234</span>      * @param {String} id Request id
<span class='linenumber'> 235</span>      */</span><span class="WHIT">
<span class='linenumber'> 236</span> </span><span class="WHIT">    </span><span class="NAME">abort</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 237</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._registry</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 238</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 239</span> </span><span class="WHIT">        </span><span class="NAME">tau.log.debug</span><span class="PUNC">(</span><span class="STRN">'aborted ('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 240</span> </span><span class="WHIT">        </span><span class="NAME">ctx.req.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Avoid timeout race condition</span><span class="WHIT">
<span class='linenumber'> 241</span> </span><span class="WHIT">        </span><span class="NAME">ctx.req.abort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 242</span> </span><span class="WHIT">        </span><span class="NAME">ctx.release</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 243</span> </span><span class="WHIT">        </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_ABORTED</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 244</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 245</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 246</span> 
<span class='linenumber'> 247</span> </span><span class="WHIT">    </span><span class="COMM">/** No need to Garbage collect XMLHttpRequest; empty function. */</span><span class="WHIT">
<span class='linenumber'> 248</span> </span><span class="WHIT">    </span><span class="NAME">gc</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.emptyFn</span><span class="WHIT">
<span class='linenumber'> 249</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 250</span> 
<span class='linenumber'> 251</span> 
<span class='linenumber'> 252</span> </span><span class="WHIT">  </span><span class="COMM">/** @lends tau.data.XSSRequest */</span><span class="WHIT">
<span class='linenumber'> 253</span> </span><span class="WHIT">  </span><span class="NAME">$class</span><span class="PUNC">(</span><span class="STRN">'tau.data.XSSRequest'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">define</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 254</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 255</span>      * @class
<span class='linenumber'> 256</span>      * Cross Script loading request helper.
<span class='linenumber'> 257</span>      * &lt;p/>
<span class='linenumber'> 258</span>      * System Events Fired:
<span class='linenumber'> 259</span>      * &lt;pre>
<span class='linenumber'> 260</span>      *  Request sent: "requestsent" (tau.rt.Event.REQ_SENT)
<span class='linenumber'> 261</span>      *  Request received: "requestreceived" (tau.rt.Event.REQ_RECEIVED)
<span class='linenumber'> 262</span>      *  Request aborted: "requestaborted" (tau.rt.Event.REQ_ABORTED)
<span class='linenumber'> 263</span>      * &lt;/pre>
<span class='linenumber'> 264</span>      * @constructs
<span class='linenumber'> 265</span>      */</span><span class="WHIT">
<span class='linenumber'> 266</span> </span><span class="WHIT">    </span><span class="NAME">XSSRequest</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 267</span> </span><span class="WHIT">      </span><span class="COMM">/** @private Default options */</span><span class="WHIT">
<span class='linenumber'> 268</span> </span><span class="WHIT">      </span><span class="NAME">this._opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_createRequestOpts</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 269</span> </span><span class="WHIT">      </span><span class="COMM">// JSONP namespace Must be globally accessible</span><span class="WHIT">
<span class='linenumber'> 270</span> </span><span class="WHIT">      </span><span class="NAME">this._opts.jsonpNamespace</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._opts.jsonpNamespace</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.$classname</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 271</span> </span><span class="WHIT">      </span><span class="COMM">/** @private Maps request id to request per JSONP namespace */</span><span class="WHIT">
<span class='linenumber'> 272</span> </span><span class="WHIT">      </span><span class="NAME">this._registry</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$class.forName</span><span class="PUNC">(</span><span class="NAME">this._opts.jsonpNamespace</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 273</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 274</span> 
<span class='linenumber'> 275</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 276</span>      * Sends a request using dynamic script loading.
<span class='linenumber'> 277</span>      * @param {String} url URL to send the 
<span class='linenumber'> 278</span>      * @param {Function} callbackFn Request success/fail callback function
<span class='linenumber'> 279</span>      * @param {Object} opts Request options
<span class='linenumber'> 280</span>      * @returns {String} Request id
<span class='linenumber'> 281</span>      */</span><span class="WHIT">
<span class='linenumber'> 282</span> </span><span class="WHIT">    </span><span class="NAME">send</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callbackFn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 283</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 284</span> </span><span class="WHIT">          </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 285</span> </span><span class="WHIT">        </span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.genId</span><span class="PUNC">(</span><span class="STRN">'xss'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 286</span> </span><span class="WHIT">        </span><span class="NAME">req</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">tau.ScriptHelper</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 287</span> </span><span class="WHIT">        </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 288</span> </span><span class="WHIT">        </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.isString</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 289</span> </span><span class="WHIT">        </span><span class="NAME">callbackFn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">callbackFn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">callbackFn</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 290</span> 
<span class='linenumber'> 291</span> </span><span class="WHIT">        </span><span class="COMM">// Mimics xhr.readyState:</span><span class="WHIT">
<span class='linenumber'> 292</span> </span><span class="WHIT">        </span><span class="COMM">// 0 Uninitialized, 1 Loading, 2 Loaded, 3 Interactive, 4 Complete</span><span class="WHIT">
<span class='linenumber'> 293</span> </span><span class="WHIT">        </span><span class="NAME">readyState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 294</span> 
<span class='linenumber'> 295</span> </span><span class="WHIT">        </span><span class="COMM">/** Mimics xhr.send(). 
<span class='linenumber'> 296</span>          * @inner */</span><span class="WHIT">
<span class='linenumber'> 297</span> </span><span class="WHIT">        </span><span class="NAME">send</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 298</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 299</span> </span><span class="WHIT">            </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// open() was called successfully</span><span class="WHIT">
<span class='linenumber'> 300</span> 
<span class='linenumber'> 301</span> </span><span class="WHIT">            </span><span class="COMM">// Internal request ready, send request via script loading</span><span class="WHIT">
<span class='linenumber'> 302</span> </span><span class="WHIT">            </span><span class="NAME">ctx.req.ctx.setAttribute</span><span class="PUNC">(</span><span class="STRN">'id'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 303</span> </span><span class="WHIT">            </span><span class="NAME">ctx.req.load</span><span class="PUNC">(</span><span class="NAME">ctx.url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.release</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// called after responseProxy</span><span class="WHIT">
<span class='linenumber'> 304</span> 
<span class='linenumber'> 305</span> </span><span class="WHIT">            </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// The request was successfully sent</span><span class="WHIT">
<span class='linenumber'> 306</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 307</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 308</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 309</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 310</span> 
<span class='linenumber'> 311</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='linenumber'> 312</span>          * Uused to process successful responses or errors, and to call 
<span class='linenumber'> 313</span>          * client's &lt;code>callbackFn&lt;/code> function.
<span class='linenumber'> 314</span>          * &lt;p/>
<span class='linenumber'> 315</span>          * Mimics the behavior of the &lt;code>XMLHttpRequest&lt;/code>'s
<span class='linenumber'> 316</span>          * &lt;code>onreadystatechange&lt;/code> function in handling requests. 
<span class='linenumber'> 317</span>          * Accordingly, the XHR states are imitated by the 
<span class='linenumber'> 318</span>          * &lt;code>readyState&lt;/code> variable. 
<span class='linenumber'> 319</span>          * &lt;p/>
<span class='linenumber'> 320</span>          * If the &lt;code>_Response&lt;/code> instance is the &lt;code>value&lt;/code> of 
<span class='linenumber'> 321</span>          * the parameter, an error has occurred to the request. Otherwise, 
<span class='linenumber'> 322</span>          * the &lt;code>value&lt;/code> is the actual request sent from the server.
<span class='linenumber'> 323</span>          * &lt;p/>
<span class='linenumber'> 324</span>          * Note: client-aborted requests must not be handled here because 
<span class='linenumber'> 325</span>          * aborted request must not call the &lt;code>callbackFn&lt;/code>.
<span class='linenumber'> 326</span>          * @inner
<span class='linenumber'> 327</span>          * @param value {Object} Payload from the server or Error Response
<span class='linenumber'> 328</span>          */</span><span class="WHIT">
<span class='linenumber'> 329</span> </span><span class="WHIT">        </span><span class="NAME">responseProxy</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 330</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 331</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 332</span> </span><span class="WHIT">            </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Currently receiving data</span><span class="WHIT">
<span class='linenumber'> 333</span> 
<span class='linenumber'> 334</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 335</span> </span><span class="WHIT">              </span><span class="COMM">// Error initiated by the client: cannot abort script load</span><span class="WHIT">
<span class='linenumber'> 336</span> </span><span class="WHIT">              </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 337</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 338</span> </span><span class="WHIT">              </span><span class="COMM">// Successfully received response via Proxy (status: 200 - 299)</span><span class="WHIT">
<span class='linenumber'> 339</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isString</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 340</span> </span><span class="WHIT">                </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">(</span><span class="NUMB">200</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'OK'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'html/text'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 341</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 342</span> </span><span class="WHIT">                </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">(</span><span class="NUMB">200</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'OK'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'application/json'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 343</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 344</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 345</span> </span><span class="WHIT">            </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 346</span> </span><span class="WHIT">            </span><span class="NAME">tau.log.debug</span><span class="PUNC">(</span><span class="STRN">'status: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">resp.statusText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' ('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">that</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 347</span> 
<span class='linenumber'> 348</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">ctx.callbackFn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 349</span> </span><span class="WHIT">              </span><span class="NAME">ctx.callbackFn</span><span class="PUNC">(</span><span class="NAME">resp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Client callback with native response              </span><span class="WHIT">
<span class='linenumber'> 350</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 351</span> 
<span class='linenumber'> 352</span> </span><span class="WHIT">            </span><span class="COMM">// Must not release req here because script loading cannot be </span><span class="WHIT">
<span class='linenumber'> 353</span> </span><span class="WHIT">            </span><span class="COMM">// canceled; the server will eventually execute this callback.</span><span class="WHIT">
<span class='linenumber'> 354</span> </span><span class="WHIT">            </span><span class="COMM">// Just stop any withstanding timeouts.</span><span class="WHIT">
<span class='linenumber'> 355</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.timeoutId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 356</span> </span><span class="WHIT">              </span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">ctx.timeoutId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 357</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 358</span> </span><span class="WHIT">            </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_RECEIVED</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 359</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 360</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 361</span> 
<span class='linenumber'> 362</span> </span><span class="WHIT">        </span><span class="COMM">/** Releases all of req's resources.
<span class='linenumber'> 363</span>          * @inner */</span><span class="WHIT">
<span class='linenumber'> 364</span> </span><span class="WHIT">        </span><span class="NAME">release</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 365</span> </span><span class="WHIT">          </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">that._registry</span><span class="PUNC">[</span><span class="NAME">ctx.id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 366</span> </span><span class="WHIT">          </span><span class="NAME">ctx.req.unload</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 367</span> </span><span class="WHIT">          </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 368</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 369</span> 
<span class='linenumber'> 370</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='linenumber'> 371</span>          * Checks if the request context has timed out.
<span class='linenumber'> 372</span>          * @inner
<span class='linenumber'> 373</span>          * @param {Number} buff Extra buffer in Milliseconds before the timeout 
<span class='linenumber'> 374</span>          */</span><span class="WHIT">
<span class='linenumber'> 375</span> </span><span class="WHIT">        </span><span class="NAME">isTimedOut</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">buff</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 376</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ctx.timestamp</span><span class="WHIT">
<span class='linenumber'> 377</span> </span><span class="WHIT">              </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">buff</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">ctx.timeout</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 378</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 379</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._opts</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 380</span> 
<span class='linenumber'> 381</span> </span><span class="WHIT">      </span><span class="COMM">// XSS is always async: register request ctx and setup timeout</span><span class="WHIT">
<span class='linenumber'> 382</span> </span><span class="WHIT">      </span><span class="NAME">that._registry</span><span class="PUNC">[</span><span class="NAME">ctx.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 383</span> </span><span class="WHIT">      </span><span class="NAME">ctx.timeoutId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_createTimeout</span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 384</span> 
<span class='linenumber'> 385</span> </span><span class="WHIT">      </span><span class="COMM">// JSONP requests need callback parameters</span><span class="WHIT">
<span class='linenumber'> 386</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">'JSONP'</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ctx.type.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 387</span> </span><span class="WHIT">        </span><span class="NAME">ctx.url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.url</span><span class="PUNC">(</span><span class="NAME">ctx.url</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">appendParam</span><span class="PUNC">(</span><span class="WHIT">
<span class='linenumber'> 388</span> </span><span class="WHIT">                    </span><span class="NAME">ctx.jsonpCallback</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'callback'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 389</span> </span><span class="WHIT">                    </span><span class="NAME">ctx.jsonpNamespace</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'.'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'.responseProxy'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 390</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 391</span> </span><span class="WHIT">      </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_SENT</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 392</span> 
<span class='linenumber'> 393</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctx.send</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 394</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 395</span> 
<span class='linenumber'> 396</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 397</span>      * Aborts a request previously sent by its id.
<span class='linenumber'> 398</span>      * @param {String} id Request id
<span class='linenumber'> 399</span>      * @ignore 
<span class='linenumber'> 400</span>      */</span><span class="WHIT">
<span class='linenumber'> 401</span> </span><span class="WHIT">    </span><span class="NAME">abort</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 402</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._registry</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 403</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 404</span> </span><span class="WHIT">        </span><span class="NAME">tau.log.debug</span><span class="PUNC">(</span><span class="STRN">'aborted ('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 405</span> </span><span class="WHIT">        </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 406</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.timeoutId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 407</span> </span><span class="WHIT">          </span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">ctx.timeoutId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 408</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 409</span> </span><span class="WHIT">        </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_ABORTED</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 410</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 411</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 412</span> 
<span class='linenumber'> 413</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 414</span>      * Garbage-collect any unprocessed or withstanding requests.
<span class='linenumber'> 415</span>      * @param buff {Number} Additional timeout buffer
<span class='linenumber'> 416</span>      */</span><span class="WHIT">
<span class='linenumber'> 417</span> </span><span class="WHIT">    </span><span class="NAME">gc</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">buff</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 418</span> </span><span class="WHIT">      </span><span class="NAME">tau.forEach</span><span class="PUNC">(</span><span class="NAME">this._registry</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 419</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">ctx.isTimedOut</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ctx.isTimedOut</span><span class="PUNC">(</span><span class="NAME">buff</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 420</span> </span><span class="WHIT">          </span><span class="NAME">ctx.release</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 421</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 422</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 423</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 424</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 425</span> 
<span class='linenumber'> 426</span> 
<span class='linenumber'> 427</span> </span><span class="WHIT">  </span><span class="COMM">// Default Request Options</span><span class="WHIT">
<span class='linenumber'> 428</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_DATASOURCEOPTS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 429</span> </span><span class="WHIT">    </span><span class="NAME">remoteSort</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 430</span> </span><span class="WHIT">    </span><span class="NAME">remoteFilter</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 431</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'> 432</span> </span><span class="WHIT">    </span><span class="NAME">groupField</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 433</span> </span><span class="WHIT">    </span><span class="NAME">getGroupName</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 434</span> </span><span class="WHIT">    </span><span class="NAME">groupDir</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"ASC"</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 435</span> </span><span class="WHIT">    </span><span class="NAME">dir</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"ASC"</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 436</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'> 437</span> </span><span class="WHIT">    </span><span class="NAME">pageSize</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">25</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 438</span> </span><span class="WHIT">    </span><span class="COMM">// TODO</span><span class="WHIT">
<span class='linenumber'> 439</span> </span><span class="WHIT">    </span><span class="NAME">batchUpdateMode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'operation'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 440</span> </span><span class="WHIT">    </span><span class="NAME">filterOnLoad</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 441</span> </span><span class="WHIT">    </span><span class="NAME">sortOnLoad</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 442</span> </span><span class="WHIT">    </span><span class="NAME">sorter</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 443</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'> 444</span> </span><span class="WHIT">    </span><span class="NAME">data</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 445</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'> 446</span> </span><span class="WHIT">    </span><span class="NAME">proxy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 447</span> </span><span class="WHIT">    </span><span class="NAME">proxyLoad</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 448</span> </span><span class="WHIT">    </span><span class="NAME">req</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT">
<span class='linenumber'> 449</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 450</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='linenumber'> 451</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_REQUESTOPTS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 452</span> </span><span class="WHIT">    </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'xml'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">/* xss : XSSRequest, xml : XMLRequest // storage에 대해서도 처리? 우선 보류 */</span><span class="WHIT">
<span class='linenumber'> 453</span> </span><span class="WHIT">    </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 454</span> </span><span class="WHIT">    </span><span class="NAME">reader</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 455</span> </span><span class="WHIT">    </span><span class="NAME">opt</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT">
<span class='linenumber'> 456</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 457</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='linenumber'> 458</span> </span><span class="WHIT">  </span><span class="COMM">// Default Request Options</span><span class="WHIT">
<span class='linenumber'> 459</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_MODELOPTS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 460</span> </span><span class="WHIT">    </span><span class="NAME">id</span><span class="WHIT">  </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 461</span> </span><span class="WHIT">    </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 462</span> </span><span class="WHIT">    </span><span class="NAME">mapping</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 463</span> </span><span class="WHIT">    </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 464</span> </span><span class="WHIT">    </span><span class="NAME">defaultValue</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 465</span> </span><span class="WHIT">    </span><span class="NAME">sortType</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT">
<span class='linenumber'> 466</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 467</span> 
<span class='linenumber'> 468</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='linenumber'> 469</span>    * @name tau.data
<span class='linenumber'> 470</span>    * @namespace Data Model.
<span class='linenumber'> 471</span>    */</span><span class="WHIT">
<span class='linenumber'> 472</span> </span><span class="WHIT">  </span><span class="NAME">tau.namespace</span><span class="PUNC">(</span><span class="STRN">'tau.data'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">/** @lends tau.data.prototype */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 473</span> </span><span class="WHIT">    </span><span class="NAME">_MODELMGR</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Model manager singleton instance</span><span class="WHIT">
<span class='linenumber'> 474</span> 
<span class='linenumber'> 475</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 476</span>      * Singleton Model Manager instance getter.
<span class='linenumber'> 477</span>      * @returns {object} Singleton {@link tau.data.ModelMgr} instance
<span class='linenumber'> 478</span>      */</span><span class="WHIT">
<span class='linenumber'> 479</span> </span><span class="WHIT">    </span><span class="NAME">getModelMgr</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 480</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._MODELMGR</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 481</span> </span><span class="WHIT">        </span><span class="NAME">this._MODELMGR</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">tau.data.ModelMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 482</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 483</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._MODELMGR</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 484</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 485</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'> 486</span> </span><span class="WHIT">    </span><span class="NAME">registerModel</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">modelname</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 487</span> </span><span class="WHIT">      </span><span class="NAME">this.getModelMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">registerModel</span><span class="PUNC">(</span><span class="NAME">modelname</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 488</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 489</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 490</span> 
<span class='linenumber'> 491</span> </span><span class="WHIT">  </span><span class="COMM">//----------------------------------------------------------------------------</span><span class="WHIT">
<span class='linenumber'> 492</span> </span><span class="WHIT">  </span><span class="COMM">/** @lends tau.data.ModelMgr */</span><span class="WHIT">
<span class='linenumber'> 493</span> </span><span class="WHIT">  </span><span class="NAME">$class</span><span class="PUNC">(</span><span class="STRN">'tau.data.ModelMgr'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">define</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 494</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 495</span>      * Constructor
<span class='linenumber'> 496</span>      * @class class definition goes here
<span class='linenumber'> 497</span>      * @constructs
<span class='linenumber'> 498</span>      */</span><span class="WHIT">
<span class='linenumber'> 499</span> </span><span class="WHIT">    </span><span class="NAME">ModelMgr</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 500</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._MODELMGR</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 501</span> </span><span class="WHIT">        </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="WHIT">
<span class='linenumber'> 502</span> </span><span class="WHIT">            </span><span class="STRN">'tau.data.ModelMgr: Only one model manager instance may exist!'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 503</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 504</span> </span><span class="WHIT">      </span><span class="NAME">this.types</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 505</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 506</span> 
<span class='linenumber'> 507</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 508</span>      * Registers a model definition. All model plugins marked with
<span class='linenumber'> 509</span>      * isDefault: true are bootstrapped immediately, as are any addition
<span class='linenumber'> 510</span>      * plugins defined in the model config.
<span class='linenumber'> 511</span>      */</span><span class="WHIT">
<span class='linenumber'> 512</span> </span><span class="WHIT">    </span><span class="NAME">registerModel</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">modelname</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 513</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sorttype</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">props</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 514</span> </span><span class="WHIT">          </span><span class="NAME">model</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 515</span> </span><span class="WHIT">        </span><span class="NAME">tau.data.Model.prototype.constructor.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 516</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 517</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isArray</span><span class="PUNC">(</span><span class="NAME">fields</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 518</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">fields.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 519</span> </span><span class="WHIT">          </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 520</span> </span><span class="WHIT">          </span><span class="NAME">sorttype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.data.SortTypes</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 521</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isString</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 522</span> </span><span class="WHIT">            </span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 523</span> </span><span class="WHIT">              </span><span class="STRN">'name'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 524</span> </span><span class="WHIT">              </span><span class="STRN">'sortType'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sorttype.asUCString</span><span class="WHIT">
<span class='linenumber'> 525</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 526</span> </span><span class="WHIT">            </span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_MODELOPTS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 527</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isObject</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 528</span> 
<span class='linenumber'> 529</span> </span><span class="WHIT">            </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">[</span><span class="STRN">'type'</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 530</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'boolean'</span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'> 531</span> </span><span class="WHIT">              </span><span class="NAME">key</span><span class="PUNC">[</span><span class="STRN">'sortType'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorttype.asUCString</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 532</span> </span><span class="WHIT">              </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 533</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'number'</span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'> 534</span> </span><span class="WHIT">              </span><span class="NAME">key</span><span class="PUNC">[</span><span class="STRN">'sortType'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorttype.asFloat</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 535</span> </span><span class="WHIT">              </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 536</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'date'</span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'> 537</span> </span><span class="WHIT">              </span><span class="NAME">key</span><span class="PUNC">[</span><span class="STRN">'sortType'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorttype.asDate</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 538</span> </span><span class="WHIT">              </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 539</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'> 540</span> </span><span class="WHIT">            </span><span class="KEYW">default</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">  </span><span class="WHIT">
<span class='linenumber'> 541</span> </span><span class="WHIT">              </span><span class="NAME">key</span><span class="PUNC">[</span><span class="STRN">'sortType'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorttype.asUCString</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 542</span> </span><span class="WHIT">              </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 543</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 544</span> </span><span class="WHIT">            </span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">key.name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_MODELOPTS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 545</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 546</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 547</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 548</span> </span><span class="WHIT">      </span><span class="NAME">model</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.extend</span><span class="PUNC">(</span><span class="NAME">model</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tau.data.Model</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 549</span> </span><span class="WHIT">        </span><span class="STRN">'fields'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">props</span><span class="WHIT">
<span class='linenumber'> 550</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 551</span> </span><span class="WHIT">      </span><span class="NAME">this.types</span><span class="PUNC">[</span><span class="NAME">modelname</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">model</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 552</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">model</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 553</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 554</span> 
<span class='linenumber'> 555</span> </span><span class="WHIT">    </span><span class="NAME">create</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 556</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.types</span><span class="PUNC">[</span><span class="NAME">name</span><span class="WHIT">
<span class='linenumber'> 557</span> </span><span class="WHIT">          </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">config.name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 558</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">(</span><span class="NAME">config</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 559</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 560</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 561</span> 
<span class='linenumber'> 562</span> </span><span class="WHIT">  </span><span class="COMM">//----------------------------------------------------------------------------</span><span class="WHIT">
<span class='linenumber'> 563</span> </span><span class="WHIT">  </span><span class="COMM">/** @lends tau.data.Reader */</span><span class="WHIT">
<span class='linenumber'> 564</span> </span><span class="WHIT">  </span><span class="NAME">$class</span><span class="PUNC">(</span><span class="STRN">'tau.data.Reader'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">define</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 565</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 566</span>      * Constructor
<span class='linenumber'> 567</span>      * @class class definition goes here
<span class='linenumber'> 568</span>      * @constructs
<span class='linenumber'> 569</span>      */</span><span class="WHIT">
<span class='linenumber'> 570</span> </span><span class="WHIT">    </span><span class="NAME">Reader</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rawdata</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 571</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 572</span> </span><span class="WHIT">    </span><span class="NAME">getItem</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 573</span> </span><span class="WHIT">    </span><span class="NAME">getCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 574</span> </span><span class="WHIT">    </span><span class="NAME">getTotalCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">getCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 575</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 576</span> 
<span class='linenumber'> 577</span> 
<span class='linenumber'> 578</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='linenumber'> 579</span>    * @class tau.data.SortTypes
<span class='linenumber'> 580</span>    * @singleton Defines the default sorting (casting?) comparison functions used
<span class='linenumber'> 581</span>    *            when sorting data.
<span class='linenumber'> 582</span>    */</span><span class="WHIT">
<span class='linenumber'> 583</span> </span><span class="WHIT">  </span><span class="NAME">tau.data.SortTypes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 584</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 585</span>      * Default sort that does nothing
<span class='linenumber'> 586</span>      * @param {Mixed} s The value being converted
<span class='linenumber'> 587</span>      * @return {Mixed} The comparison value
<span class='linenumber'> 588</span>      */</span><span class="WHIT">
<span class='linenumber'> 589</span> </span><span class="WHIT">    </span><span class="NAME">none</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 590</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 591</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 592</span> 
<span class='linenumber'> 593</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 594</span>      * The regular expression used to strip tags
<span class='linenumber'> 595</span>      * @type {RegExp}
<span class='linenumber'> 596</span>      * @property
<span class='linenumber'> 597</span>      */</span><span class="WHIT">
<span class='linenumber'> 598</span> </span><span class="WHIT">    </span><span class="NAME">stripTagsRE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="REGX">/&lt;\/?[^>]+>/gi</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 599</span> 
<span class='linenumber'> 600</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 601</span>      * Strips all HTML tags to sort on text only
<span class='linenumber'> 602</span>      * @param {Mixed} s The value being converted
<span class='linenumber'> 603</span>      * @return {String} The comparison value
<span class='linenumber'> 604</span>      */</span><span class="WHIT">
<span class='linenumber'> 605</span> </span><span class="WHIT">    </span><span class="NAME">asText</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 606</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="NAME">this.stripTagsRE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 607</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 608</span> 
<span class='linenumber'> 609</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 610</span>      * Strips all HTML tags to sort on text only - Case insensitive
<span class='linenumber'> 611</span>      * @param {Mixed} s The value being converted
<span class='linenumber'> 612</span>      * @return {String} The comparison value
<span class='linenumber'> 613</span>      */</span><span class="WHIT">
<span class='linenumber'> 614</span> </span><span class="WHIT">    </span><span class="NAME">asUCText</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 615</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="NAME">this.stripTagsRE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 616</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 617</span> 
<span class='linenumber'> 618</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 619</span>      * Case insensitive string
<span class='linenumber'> 620</span>      * @param {Mixed} s The value being converted
<span class='linenumber'> 621</span>      * @return {String} The comparison value
<span class='linenumber'> 622</span>      */</span><span class="WHIT">
<span class='linenumber'> 623</span> </span><span class="WHIT">    </span><span class="NAME">asUCString</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 624</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 625</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 626</span> 
<span class='linenumber'> 627</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 628</span>      * Date sorting
<span class='linenumber'> 629</span>      * @param {Mixed} s The value being converted
<span class='linenumber'> 630</span>      * @return {Number} The comparison value
<span class='linenumber'> 631</span>      */</span><span class="WHIT">
<span class='linenumber'> 632</span> </span><span class="WHIT">    </span><span class="NAME">asDate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 633</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 634</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 635</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 636</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isDate</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 637</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s.getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 638</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 639</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Date.parse</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 640</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 641</span> 
<span class='linenumber'> 642</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 643</span>      * Float sorting
<span class='linenumber'> 644</span>      * @param {Mixed} s The value being converted
<span class='linenumber'> 645</span>      * @return {Float} The comparison value
<span class='linenumber'> 646</span>      */</span><span class="WHIT">
<span class='linenumber'> 647</span> </span><span class="WHIT">    </span><span class="NAME">asFloat</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 648</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/,/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 649</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 650</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 651</span> 
<span class='linenumber'> 652</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 653</span>      * Integer sorting
<span class='linenumber'> 654</span>      * @param {Mixed} s The value being converted
<span class='linenumber'> 655</span>      * @return {Number} The comparison value
<span class='linenumber'> 656</span>      */</span><span class="WHIT">
<span class='linenumber'> 657</span> </span><span class="WHIT">    </span><span class="NAME">asInt</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 658</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/,/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 659</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 660</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 661</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 662</span> 
<span class='linenumber'> 663</span> </span><span class="WHIT">  </span><span class="COMM">//----------------------------------------------------------------------------</span><span class="WHIT">
<span class='linenumber'> 664</span> </span><span class="WHIT">  </span><span class="COMM">/** @lends tau.data.Datasource */</span><span class="WHIT">
<span class='linenumber'> 665</span> </span><span class="WHIT">  </span><span class="NAME">$class</span><span class="PUNC">(</span><span class="STRN">'tau.data.Datasource'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">extend</span><span class="PUNC">(</span><span class="NAME">tau.rt.EventDelegator</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">define</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 666</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 667</span>      * Constructor
<span class='linenumber'> 668</span>      * @class tau.data.Datasource definition goes here
<span class='linenumber'> 669</span>      * @extends tau.rt.EventDelegator
<span class='linenumber'> 670</span>      * @constructs
<span class='linenumber'> 671</span>      */</span><span class="WHIT">
<span class='linenumber'> 672</span> </span><span class="WHIT">    </span><span class="NAME">Datasource</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">model</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 673</span> </span><span class="WHIT">      </span><span class="NAME">this.init</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 674</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">model</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 675</span> </span><span class="WHIT">        </span><span class="NAME">this.model</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.data.getModelMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">model</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 676</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 677</span> </span><span class="WHIT">      </span><span class="NAME">this._currentPage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 678</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'> 679</span>        * Temporary cache in which removed model instances are kept until
<span class='linenumber'> 680</span>        * successfully synchronised with a Proxy, at which point this is
<span class='linenumber'> 681</span>        * cleared.
<span class='linenumber'> 682</span>        */</span><span class="WHIT">
<span class='linenumber'> 683</span> </span><span class="WHIT">      </span><span class="NAME">this._removed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 684</span> 
<span class='linenumber'> 685</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'> 686</span>        * this Datasource's local cache of records
<span class='linenumber'> 687</span>        */</span><span class="WHIT">
<span class='linenumber'> 688</span> </span><span class="WHIT">      </span><span class="NAME">this._data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">tau.ItemRegistry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 689</span> </span><span class="WHIT">        </span><span class="NAME">clear</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 690</span> </span><span class="WHIT">          </span><span class="NAME">this._registryArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 691</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 692</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='linenumber'> 693</span> </span><span class="WHIT">        </span><span class="NAME">addItem</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 694</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">children</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getArrayItems</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 695</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">children</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">tau.arr</span><span class="PUNC">(</span><span class="NAME">children</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">pushUnique</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 696</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">tau.isUndefined</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 697</span> </span><span class="WHIT">              </span><span class="NAME">this._registryMap</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 698</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 699</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 700</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 701</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 702</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 703</span> 
<span class='linenumber'> 704</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='linenumber'> 705</span>          * @private Performs the actual sorting based on a
<span class='linenumber'> 706</span>          *          direction and a sorting function.
<span class='linenumber'> 707</span>          *          Internally, this creates a temporary array
<span class='linenumber'> 708</span>          *          of all items in the MixedCollection, sorts
<span class='linenumber'> 709</span>          *          it and then writes the sorted array data
<span class='linenumber'> 710</span>          *          back into this.items and this.keys
<span class='linenumber'> 711</span>          * @param {String} property Property to sort by ('key',
<span class='linenumber'> 712</span>          *        'value', or 'index')
<span class='linenumber'> 713</span>          * @param {String} dir (optional) Direction to sort
<span class='linenumber'> 714</span>          *        'ASC' or 'DESC'. Defaults to 'ASC'.
<span class='linenumber'> 715</span>          * @param {Function} fn (optional) Comparison function
<span class='linenumber'> 716</span>          *        that defines the sort order. Defaults to
<span class='linenumber'> 717</span>          *        sorting by numeric value.
<span class='linenumber'> 718</span>          */</span><span class="WHIT">
<span class='linenumber'> 719</span> </span><span class="WHIT">        </span><span class="NAME">_sort</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">property</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 720</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dsc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">dir</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'DESC'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT">
<span class='linenumber'> 721</span> </span><span class="WHIT">              </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 722</span> 
<span class='linenumber'> 723</span> </span><span class="WHIT">          </span><span class="COMM">// this is a temporary array used to apply the sorting</span><span class="WHIT">
<span class='linenumber'> 724</span> </span><span class="WHIT">          </span><span class="COMM">// function</span><span class="WHIT">
<span class='linenumber'> 725</span> </span><span class="WHIT">          </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._registryArray</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 726</span> 
<span class='linenumber'> 727</span> </span><span class="WHIT">          </span><span class="COMM">// default to a simple sorter function if one is not</span><span class="WHIT">
<span class='linenumber'> 728</span> </span><span class="WHIT">          </span><span class="COMM">// provided</span><span class="WHIT">
<span class='linenumber'> 729</span> </span><span class="WHIT">          </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 730</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 731</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 732</span> 
<span class='linenumber'> 733</span> </span><span class="WHIT">          </span><span class="COMM">// copy all the items into a temporary array, which we</span><span class="WHIT">
<span class='linenumber'> 734</span> </span><span class="WHIT">          </span><span class="COMM">// will sort</span><span class="WHIT">
<span class='linenumber'> 735</span> </span><span class="WHIT">          </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">items.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 736</span> </span><span class="WHIT">            </span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">c.length</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 737</span> </span><span class="WHIT">              </span><span class="NAME">value</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 738</span> </span><span class="WHIT">              </span><span class="NAME">index</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT">
<span class='linenumber'> 739</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 740</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 741</span> 
<span class='linenumber'> 742</span> </span><span class="WHIT">          </span><span class="COMM">// sort the temporary array</span><span class="WHIT">
<span class='linenumber'> 743</span> </span><span class="WHIT">          </span><span class="NAME">c.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 744</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dsc</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 745</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 746</span> </span><span class="WHIT">              </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a.index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">b.index</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 747</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 748</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 749</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 750</span> 
<span class='linenumber'> 751</span> </span><span class="WHIT">          </span><span class="COMM">// copy the temporary array back into the main</span><span class="WHIT">
<span class='linenumber'> 752</span> </span><span class="WHIT">          </span><span class="COMM">// this.items and this.keys objects</span><span class="WHIT">
<span class='linenumber'> 753</span> </span><span class="WHIT">          </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 754</span> </span><span class="WHIT">            </span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 755</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 756</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 757</span> 
<span class='linenumber'> 758</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='linenumber'> 759</span>          * Sorts this collection by &lt;b>item&lt;/b> value with the
<span class='linenumber'> 760</span>          * passed comparison function.
<span class='linenumber'> 761</span>          * @param {String} dir (optional) 'ASC' or 'DESC'.
<span class='linenumber'> 762</span>          *        Defaults to 'ASC'.
<span class='linenumber'> 763</span>          * @param {Function} fn (optional) Comparison function
<span class='linenumber'> 764</span>          *        that defines the sort order. Defaults to
<span class='linenumber'> 765</span>          *        sorting by numeric value.
<span class='linenumber'> 766</span>          */</span><span class="WHIT">
<span class='linenumber'> 767</span> </span><span class="WHIT">        </span><span class="NAME">sort</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dir</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 768</span> </span><span class="WHIT">          </span><span class="NAME">this._sort</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 769</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 770</span> 
<span class='linenumber'> 771</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='linenumber'> 772</span>          * Filter the &lt;i>objects&lt;/i> in this collection by a
<span class='linenumber'> 773</span>          * specific property. Returns a new collection that has
<span class='linenumber'> 774</span>          * been filtered.
<span class='linenumber'> 775</span>          * @param {String} property A property on your objects
<span class='linenumber'> 776</span>          * @param {String/RegExp} value Either string that the
<span class='linenumber'> 777</span>          *        property values should start with or a RegExp
<span class='linenumber'> 778</span>          *        to test against the property
<span class='linenumber'> 779</span>          * @param {Boolean} anyMatch (optional) True to match
<span class='linenumber'> 780</span>          *        any part of the string, not just the beginning
<span class='linenumber'> 781</span>          * @param {Boolean} caseSensitive (optional) True for
<span class='linenumber'> 782</span>          *        case sensitive comparison (defaults to False).
<span class='linenumber'> 783</span>          * @return {MixedCollection} The new filtered collection
<span class='linenumber'> 784</span>          */</span><span class="WHIT">
<span class='linenumber'> 785</span> </span><span class="WHIT">        </span><span class="NAME">filter</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">property</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anyMatch</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 786</span> </span><span class="WHIT">            </span><span class="NAME">caseSensitive</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">exactMatch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 787</span> </span><span class="WHIT">          </span><span class="COMM">// we can accept an array of filter objects, or a</span><span class="WHIT">
<span class='linenumber'> 788</span> </span><span class="WHIT">          </span><span class="COMM">// single filter object - normalize them here</span><span class="WHIT">
<span class='linenumber'> 789</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isObject</span><span class="PUNC">(</span><span class="NAME">property</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 790</span> </span><span class="WHIT">            </span><span class="NAME">property</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">property</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 791</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 792</span> 
<span class='linenumber'> 793</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isArray</span><span class="PUNC">(</span><span class="NAME">property</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 794</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 795</span> 
<span class='linenumber'> 796</span> </span><span class="WHIT">            </span><span class="COMM">// normalize the filters passed into an array of</span><span class="WHIT">
<span class='linenumber'> 797</span> </span><span class="WHIT">            </span><span class="COMM">// filter functions</span><span class="WHIT">
<span class='linenumber'> 798</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">property.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 799</span> </span><span class="WHIT">              </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">property</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filter.fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filter.scope</span><span class="WHIT">
<span class='linenumber'> 800</span> </span><span class="WHIT">                  </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 801</span> 
<span class='linenumber'> 802</span> </span><span class="WHIT">              </span><span class="COMM">// if we weren't given a filter function,</span><span class="WHIT">
<span class='linenumber'> 803</span> </span><span class="WHIT">              </span><span class="COMM">// construct one now</span><span class="WHIT">
<span class='linenumber'> 804</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">func</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 805</span> </span><span class="WHIT">                </span><span class="NAME">func</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createFilterFn</span><span class="PUNC">(</span><span class="NAME">filter.property</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 806</span> </span><span class="WHIT">                    </span><span class="NAME">filter.value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">filter.anyMatch</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 807</span> </span><span class="WHIT">                    </span><span class="NAME">filter.caseSensitive</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">filter.exactMatch</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 808</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 809</span> 
<span class='linenumber'> 810</span> </span><span class="WHIT">              </span><span class="NAME">filters.push</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 811</span> </span><span class="WHIT">                </span><span class="NAME">fn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 812</span> </span><span class="WHIT">                </span><span class="NAME">scope</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="WHIT">
<span class='linenumber'> 813</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 814</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 815</span> 
<span class='linenumber'> 816</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createMultipleFilterFn</span><span class="PUNC">(</span><span class="NAME">filters</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 817</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 818</span> </span><span class="WHIT">            </span><span class="COMM">// classic single property filter</span><span class="WHIT">
<span class='linenumber'> 819</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createFilterFn</span><span class="PUNC">(</span><span class="NAME">property</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 820</span> </span><span class="WHIT">                </span><span class="NAME">anyMatch</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">caseSensitive</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">exactMatch</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 821</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 822</span> 
<span class='linenumber'> 823</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.filterBy</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 824</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 825</span> 
<span class='linenumber'> 826</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='linenumber'> 827</span>          * @private Returns a filter function used to test a the
<span class='linenumber'> 828</span>          *          given property's value. Defers most of the
<span class='linenumber'> 829</span>          *          work to createValueMatcher
<span class='linenumber'> 830</span>          * @param {String} property The property to create the
<span class='linenumber'> 831</span>          *        filter function for
<span class='linenumber'> 832</span>          * @param {String/RegExp} value The string/regex to
<span class='linenumber'> 833</span>          *        compare the property value to
<span class='linenumber'> 834</span>          * @param {Boolean} anyMatch True if we don't care if
<span class='linenumber'> 835</span>          *        the filter value is not the full value
<span class='linenumber'> 836</span>          *        (defaults to false)
<span class='linenumber'> 837</span>          * @param {Boolean} caseSensitive True to create a
<span class='linenumber'> 838</span>          *        case-sensitive regex (defaults to false)
<span class='linenumber'> 839</span>          * @param {Boolean} exactMatch True to force exact match (^
<span class='linenumber'> 840</span>          *        and $ characters added to the regex). Defaults
<span class='linenumber'> 841</span>          *        to false. Ignored if anyMatch is true.
<span class='linenumber'> 842</span>          */</span><span class="WHIT">
<span class='linenumber'> 843</span> </span><span class="WHIT">        </span><span class="NAME">createFilterFn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">property</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anyMatch</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 844</span> </span><span class="WHIT">            </span><span class="NAME">caseSensitive</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">exactMatch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 845</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isUndefined</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 846</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 847</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 848</span> </span><span class="WHIT">          </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createValueMatcher</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anyMatch</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 849</span> </span><span class="WHIT">              </span><span class="NAME">caseSensitive</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">exactMatch</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 850</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 851</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value.test</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 852</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 853</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 854</span> 
<span class='linenumber'> 855</span> </span><span class="WHIT">        </span><span class="NAME">createValueMatcher</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anyMatch</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">caseSensitive</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">exactMatch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 856</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">value.exec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// not a regex</span><span class="WHIT">
<span class='linenumber'> 857</span> </span><span class="WHIT">              </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">er</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Ext.escapeRe</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 858</span> </span><span class="WHIT">              </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 859</span> 
<span class='linenumber'> 860</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anyMatch</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 861</span> </span><span class="WHIT">                  </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">er</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 862</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 863</span> </span><span class="WHIT">                  </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'^'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">er</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 864</span> </span><span class="WHIT">                  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exactMatch</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 865</span> </span><span class="WHIT">                      </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'$'</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 866</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 867</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 868</span> </span><span class="WHIT">              </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">caseSensitive</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'i'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 869</span> </span><span class="WHIT">           </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 870</span> </span><span class="WHIT">           </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 871</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 872</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='linenumber'> 873</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='linenumber'> 874</span>          * Returns a range of items in this collection
<span class='linenumber'> 875</span>          * @param {Number} startIndex (optional) The starting
<span class='linenumber'> 876</span>          *        index. Defaults to 0.
<span class='linenumber'> 877</span>          * @param {Number} endIndex (optional) The ending index.
<span class='linenumber'> 878</span>          *        Defaults to the last item.
<span class='linenumber'> 879</span>          * @return {Array} An array of items
<span class='linenumber'> 880</span>          */</span><span class="WHIT">
<span class='linenumber'> 881</span> </span><span class="WHIT">        </span><span class="NAME">getRange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 882</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">items</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.items</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 883</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">items.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 884</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 885</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 886</span> </span><span class="WHIT">          </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 887</span> </span><span class="WHIT">          </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math</span><span class="WHIT">
<span class='linenumber'> 888</span> </span><span class="WHIT">              </span><span class="PUNC">.</span><span class="NAME">min</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='linenumber'> 889</span> </span><span class="WHIT">                  </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 890</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 891</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 892</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 893</span> </span><span class="WHIT">              </span><span class="NAME">r</span><span class="PUNC">[</span><span class="NAME">r.length</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 894</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 895</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 896</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 897</span> </span><span class="WHIT">              </span><span class="NAME">r</span><span class="PUNC">[</span><span class="NAME">r.length</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 898</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 899</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 900</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 901</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 902</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// end</span><span class="WHIT">
<span class='linenumber'> 903</span> 
<span class='linenumber'> 904</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._opts.data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 905</span> </span><span class="WHIT">        </span><span class="NAME">this.inlineData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._opts.data</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 906</span> </span><span class="WHIT">        </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._opts.data</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 907</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 908</span> 
<span class='linenumber'> 909</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isUndefined</span><span class="PUNC">(</span><span class="NAME">this._opts.proxy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 910</span> </span><span class="WHIT">          </span><span class="NAME">tau.isObject</span><span class="PUNC">(</span><span class="NAME">this._opts.req</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 911</span> </span><span class="WHIT">        </span><span class="NAME">this._opts.proxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getProxy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 912</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 913</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 914</span> 
<span class='linenumber'> 915</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 916</span>      * Initializes/resets the Datasource. &lt;p/> Null/Undefined parameter
<span class='linenumber'> 917</span>      * will reset the entier datasource state.
<span class='linenumber'> 918</span>      * @param {object} opts Datasource Options
<span class='linenumber'> 919</span>      */</span><span class="WHIT">
<span class='linenumber'> 920</span> </span><span class="WHIT">    </span><span class="NAME">init</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 921</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'> 922</span>        * Datasource Options
<span class='linenumber'> 923</span>        * @private
<span class='linenumber'> 924</span>        */</span><span class="WHIT">
<span class='linenumber'> 925</span> </span><span class="WHIT">      </span><span class="NAME">this._opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_DATASOURCEOPTS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 926</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 927</span> 
<span class='linenumber'> 928</span> </span><span class="WHIT">    </span><span class="NAME">getGroups</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 929</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">records</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._data.getArrayItems</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 930</span> </span><span class="WHIT">          </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">records.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 931</span> </span><span class="WHIT">          </span><span class="NAME">groups</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pointers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 932</span> </span><span class="WHIT">          </span><span class="NAME">record</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">groupStr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">group</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 933</span> 
<span class='linenumber'> 934</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 935</span> </span><span class="WHIT">        </span><span class="NAME">record</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">records</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 936</span> </span><span class="WHIT">        </span><span class="NAME">groupStr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getGroupName</span><span class="PUNC">(</span><span class="NAME">record</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 937</span> </span><span class="WHIT">        </span><span class="NAME">group</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pointers</span><span class="PUNC">[</span><span class="NAME">groupStr</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 938</span> 
<span class='linenumber'> 939</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">group</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 940</span> </span><span class="WHIT">          </span><span class="NAME">group</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 941</span> </span><span class="WHIT">            </span><span class="NAME">name</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">groupStr</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 942</span> </span><span class="WHIT">            </span><span class="NAME">children</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">
<span class='linenumber'> 943</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 944</span> 
<span class='linenumber'> 945</span> </span><span class="WHIT">          </span><span class="NAME">groups.push</span><span class="PUNC">(</span><span class="NAME">group</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 946</span> </span><span class="WHIT">          </span><span class="NAME">pointers</span><span class="PUNC">[</span><span class="NAME">groupStr</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">group</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 947</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 948</span> 
<span class='linenumber'> 949</span> </span><span class="WHIT">        </span><span class="NAME">group.children.push</span><span class="PUNC">(</span><span class="NAME">record</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 950</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 951</span> 
<span class='linenumber'> 952</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">groups</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 953</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 954</span> 
<span class='linenumber'> 955</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 956</span>      * 그룹핑 String을 return
<span class='linenumber'> 957</span>      */</span><span class="WHIT">
<span class='linenumber'> 958</span> </span><span class="WHIT">    </span><span class="NAME">getGroupName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">instance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 959</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._opts.getGroupName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 960</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._opts.getGroupName</span><span class="PUNC">(</span><span class="NAME">instance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 961</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 962</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">instance.get</span><span class="PUNC">(</span><span class="NAME">this._opts.groupField</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 963</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 964</span> 
<span class='linenumber'> 965</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 966</span>      * Returns the Proxy currently attached to this Datasource instance
<span class='linenumber'> 967</span>      * @return {BaseRequset} The Proxy instance
<span class='linenumber'> 968</span>      */</span><span class="WHIT">
<span class='linenumber'> 969</span> </span><span class="WHIT">    </span><span class="NAME">getProxy</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 970</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._opts.proxy</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 971</span> </span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">this._opts.req.type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 972</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'xml'</span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'> 973</span> </span><span class="WHIT">          </span><span class="NAME">this._opts.proxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">tau.data.XMLRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 974</span> </span><span class="WHIT">          </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 975</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'xss'</span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'> 976</span> </span><span class="WHIT">          </span><span class="NAME">this._opts.proxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">tau.data.XSSRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 977</span> </span><span class="WHIT">          </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 978</span> </span><span class="WHIT">        </span><span class="COMM">/* TODO : storage 관련된 것도 고려해야함. */</span><span class="WHIT">  </span><span class="WHIT">
<span class='linenumber'> 979</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 980</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 981</span> </span><span class="WHIT">      </span><span class="NAME">this._opts.req</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="NAME">this._opts.req</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_REQUESTOPTS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 982</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._opts.proxy</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 983</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 984</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'> 985</span> </span><span class="WHIT">    </span><span class="COMM">/* 
<span class='linenumber'> 986</span>      * @private
<span class='linenumber'> 987</span>      * proxy send의 callback function에서 내부적으로 호출. raw 데이터를 convert를 통해 변경해준다.
<span class='linenumber'> 988</span>      */</span><span class="WHIT">
<span class='linenumber'> 989</span> </span><span class="WHIT">    </span><span class="NAME">requestCallback</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">reader</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 990</span> </span><span class="WHIT">      </span><span class="COMM">// TODO : result 정의해야함.</span><span class="WHIT">
<span class='linenumber'> 991</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resp</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 992</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resp.status</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">200</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 993</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reader</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'> 994</span> </span><span class="WHIT">          </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">reader</span><span class="PUNC">(</span><span class="NAME">resp.responseXML</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 995</span> </span><span class="WHIT">        </span><span class="NAME">this.fireEvent</span><span class="PUNC">(</span><span class="STRN">'dataloadSucess'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 996</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 997</span> </span><span class="WHIT">        </span><span class="NAME">this.fireEvent</span><span class="PUNC">(</span><span class="STRN">'dataloadFail'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">resp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 998</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 999</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1000</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1001</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1002</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1003</span>      * 데이터를 추가한다.
<span class='linenumber'>1004</span>      * @param {Object} data The data for each model
<span class='linenumber'>1005</span>      * @return {Array} The array of newly created model instances
<span class='linenumber'>1006</span>      */</span><span class="WHIT">
<span class='linenumber'>1007</span> </span><span class="WHIT">    </span><span class="NAME">add</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">record</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1008</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">record</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">tau.data.Model</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1009</span> </span><span class="WHIT">        </span><span class="NAME">record</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.data.getModelMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">create</span><span class="PUNC">(</span><span class="NAME">record</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1010</span> </span><span class="WHIT">            </span><span class="NAME">this.model</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1011</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1012</span> </span><span class="WHIT">      </span><span class="NAME">this._data.addItem</span><span class="PUNC">(</span><span class="NAME">record</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1013</span> </span><span class="WHIT">      </span><span class="NAME">record._join</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1014</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.snapshot</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1015</span> </span><span class="WHIT">        </span><span class="NAME">this.snapshot.addItem</span><span class="PUNC">(</span><span class="NAME">record</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1016</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1017</span> </span><span class="WHIT">      </span><span class="COMM">// TODO</span><span class="WHIT">
<span class='linenumber'>1018</span> </span><span class="WHIT">      </span><span class="NAME">this.fireEvent</span><span class="PUNC">(</span><span class="STRN">'add'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">record</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="NAME">this._data.length</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1019</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">record</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1020</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1021</span> 
<span class='linenumber'>1022</span> </span><span class="WHIT">    </span><span class="COMM">/* TODO
<span class='linenumber'>1023</span>      * Proxy에 데이터를 save
<span class='linenumber'>1024</span>      */</span><span class="WHIT">
<span class='linenumber'>1025</span> </span><span class="WHIT">    </span><span class="NAME">save</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1026</span> </span><span class="WHIT">      </span><span class="WHIT">
<span class='linenumber'>1027</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1028</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1029</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='linenumber'>1030</span>      * Proxy에서 데이터를 load
<span class='linenumber'>1031</span>      */</span><span class="WHIT">
<span class='linenumber'>1032</span> </span><span class="WHIT">    </span><span class="NAME">load</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1033</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">limit</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1034</span> </span><span class="WHIT">          </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1035</span> </span><span class="WHIT">       </span><span class="WHIT">
<span class='linenumber'>1036</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1037</span> </span><span class="WHIT">        </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">opts.start</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1038</span> </span><span class="WHIT">        </span><span class="NAME">limit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">opts.limit</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self._opts.pageSize</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1039</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1040</span> </span><span class="WHIT">      </span><span class="WHIT">
<span class='linenumber'>1041</span> </span><span class="WHIT">      </span><span class="COMM">// TODO : option에 대해 상세하게 정의해야함.</span><span class="WHIT">
<span class='linenumber'>1042</span> </span><span class="WHIT">      </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1043</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='linenumber'>1044</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">curData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1045</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='linenumber'>1046</span> </span><span class="WHIT">        </span><span class="NAME">tau.log.debug</span><span class="PUNC">(</span><span class="STRN">'convert ['</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">self._opts.req.convert</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">']'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1047</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='linenumber'>1048</span> </span><span class="WHIT">        </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.requestCallback</span><span class="PUNC">(</span><span class="NAME">resp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self._opts.req.convert</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1049</span> </span><span class="WHIT">        </span><span class="NAME">self._count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.getCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1050</span> 
<span class='linenumber'>1051</span> </span><span class="WHIT">        </span><span class="COMM">// 데이터를 model에 맞게 변경해준다.</span><span class="WHIT">
<span class='linenumber'>1052</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">limit</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">data.getCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1053</span> </span><span class="WHIT">          </span><span class="NAME">curData.push</span><span class="PUNC">(</span><span class="NAME">self.add</span><span class="PUNC">(</span><span class="NAME">data.getItem</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1054</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1055</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">self._opts.req.doneFn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1056</span> </span><span class="WHIT">          </span><span class="NAME">self._opts.req.doneFn</span><span class="PUNC">(</span><span class="NAME">resp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1057</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1058</span> </span><span class="WHIT">        </span><span class="NAME">self.fireEvent</span><span class="PUNC">(</span><span class="STRN">"dataload"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curData</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1059</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1060</span> </span><span class="WHIT">      </span><span class="WHIT">
<span class='linenumber'>1061</span> </span><span class="WHIT">      </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1062</span> </span><span class="WHIT">        </span><span class="NAME">this.getProxy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">send</span><span class="PUNC">(</span><span class="NAME">this._opts.req.url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>1063</span> </span><span class="WHIT">            </span><span class="NAME">this._opts.req.opt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1064</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1065</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1066</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1067</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1068</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1069</span>      * 읽어온 데이터 크기를 반환한다.
<span class='linenumber'>1070</span>      * @return {Number} 데이터 크기
<span class='linenumber'>1071</span>      */</span><span class="WHIT">
<span class='linenumber'>1072</span> </span><span class="WHIT">    </span><span class="NAME">getCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1073</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._count</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1074</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1075</span> 
<span class='linenumber'>1076</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1077</span>      * 읽어올 데이터가 있는지 여부를 반환한다.
<span class='linenumber'>1078</span>      * @return {Boolean} 데이터가 더 있는지 여부
<span class='linenumber'>1079</span>      */</span><span class="WHIT">
<span class='linenumber'>1080</span> </span><span class="WHIT">    </span><span class="NAME">hasNext</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1081</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._currentPage</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this._opts.pageSize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1082</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1083</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1084</span> </span><span class="WHIT">    </span><span class="NAME">loadData</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1085</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.inlineData</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1086</span> </span><span class="WHIT">        </span><span class="NAME">this.loadInlineData</span><span class="PUNC">(</span><span class="NAME">this.inlineData</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1087</span> </span><span class="WHIT">        </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.inlineData</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1088</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._opts.proxyLoad</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1089</span> </span><span class="WHIT">        </span><span class="NAME">this.nextPage</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1090</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1091</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1092</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1093</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1094</span>      * Datasource에 직접 지정한 array 데이터를 Model에 맞게 load한다. 
<span class='linenumber'>1095</span>      * @param {Array} data Array of data to load. Any non-model
<span class='linenumber'>1096</span>      *        instances will be cast into model instances first
<span class='linenumber'>1097</span>      * @param {boolean} append True to add the records to the existing
<span class='linenumber'>1098</span>      *        records in the datasource, false to remove the old ones first
<span class='linenumber'>1099</span>      */</span><span class="WHIT">
<span class='linenumber'>1100</span> </span><span class="WHIT">    </span><span class="NAME">loadInlineData</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">append</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1101</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">model</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.model</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1102</span> </span><span class="WHIT">      </span><span class="COMM">// make sure each data element is an tau.data.Model instance</span><span class="WHIT">
<span class='linenumber'>1103</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1104</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">record</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1105</span> 
<span class='linenumber'>1106</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">record</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">tau.data.Model</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1107</span> </span><span class="WHIT">          </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.data.getModelMgr</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">create</span><span class="PUNC">(</span><span class="NAME">record</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">model</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1108</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1109</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1110</span> 
<span class='linenumber'>1111</span> </span><span class="WHIT">      </span><span class="NAME">this._loadRecords</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">append</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1112</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1113</span> 
<span class='linenumber'>1114</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1115</span>      * Loads an array of {@tau.data.Model model} instances into the
<span class='linenumber'>1116</span>      * store, fires the datachanged event.
<span class='linenumber'>1117</span>      * @param {Array} records The array of records to load
<span class='linenumber'>1118</span>      * @param {Boolean} add True to add these records to the existing
<span class='linenumber'>1119</span>      *        records, false to remove the Store's existing records
<span class='linenumber'>1120</span>      *        first
<span class='linenumber'>1121</span>      */</span><span class="WHIT">
<span class='linenumber'>1122</span> </span><span class="WHIT">    </span><span class="NAME">_loadRecords</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">records</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1123</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">add</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1124</span> </span><span class="WHIT">        </span><span class="NAME">this._data.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1125</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1126</span> 
<span class='linenumber'>1127</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">records.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1128</span> </span><span class="WHIT">        </span><span class="NAME">records</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">_join</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1129</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1130</span> 
<span class='linenumber'>1131</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">records.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1132</span> </span><span class="WHIT">        </span><span class="NAME">this._data.addItem</span><span class="PUNC">(</span><span class="NAME">records</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1133</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1134</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._opts.filterOnLoad</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1135</span> </span><span class="WHIT">        </span><span class="NAME">this.filter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1136</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1137</span> 
<span class='linenumber'>1138</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._opts.sortOnLoad</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1139</span> </span><span class="WHIT">        </span><span class="NAME">this.sort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1140</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1141</span> </span><span class="WHIT">      </span><span class="NAME">this.fireEvent</span><span class="PUNC">(</span><span class="STRN">'dataload'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._data.getArrayItems</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1142</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1143</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1144</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1145</span>      * @private
<span class='linenumber'>1146</span>      * @param {tau.data.Model} record The model instance that was edited
<span class='linenumber'>1147</span>      */</span><span class="WHIT">
<span class='linenumber'>1148</span> </span><span class="WHIT">    </span><span class="NAME">afterEdit</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">record</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1149</span> </span><span class="WHIT">      </span><span class="NAME">this.fireEvent</span><span class="PUNC">(</span><span class="STRN">'edit'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">record</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1150</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1151</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1152</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1153</span>      * @private
<span class='linenumber'>1154</span>      * @param {tau.data.Model} record The model instance that was edited
<span class='linenumber'>1155</span>      */</span><span class="WHIT">
<span class='linenumber'>1156</span> </span><span class="WHIT">    </span><span class="NAME">afterCancel</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">record</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1157</span> </span><span class="WHIT">      </span><span class="NAME">this.fireEvent</span><span class="PUNC">(</span><span class="STRN">'cancel'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">record</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1158</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1159</span> 
<span class='linenumber'>1160</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1161</span>      * @private
<span class='linenumber'>1162</span>      * @param {tau.data.Model} record The model instance that was edited
<span class='linenumber'>1163</span>      */</span><span class="WHIT">
<span class='linenumber'>1164</span> </span><span class="WHIT">    </span><span class="NAME">afterCommit</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">record</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1165</span> </span><span class="WHIT">      </span><span class="NAME">this.fireEvent</span><span class="PUNC">(</span><span class="STRN">'commit'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">record</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1166</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1167</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1168</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1169</span>      * @param {String} dir The overall direction to sort the data
<span class='linenumber'>1170</span>      *        by. Defaults to "ASC".
<span class='linenumber'>1171</span>      * @param {Boolean} suppressEvent If true, the 'datachanged' event
<span class='linenumber'>1172</span>      *        is not fired. Defaults to false
<span class='linenumber'>1173</span>      */</span><span class="WHIT">
<span class='linenumber'>1174</span> </span><span class="WHIT">    </span><span class="NAME">sort</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sorters</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">suppressEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1175</span> </span><span class="WHIT">      </span><span class="NAME">sorters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorters</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._opts.sorters</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1176</span> </span><span class="WHIT">      </span><span class="NAME">dir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._opts.dir</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1177</span> 
<span class='linenumber'>1178</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">sorters</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1179</span> </span><span class="WHIT">        </span><span class="NAME">sorters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1180</span> </span><span class="WHIT">          </span><span class="NAME">field</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sorters</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1181</span> </span><span class="WHIT">          </span><span class="NAME">dir</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="WHIT">
<span class='linenumber'>1182</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1183</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1184</span> 
<span class='linenumber'>1185</span> </span><span class="WHIT">      </span><span class="NAME">this.sortInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1186</span> </span><span class="WHIT">        </span><span class="NAME">sorters</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sorters</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1187</span> </span><span class="WHIT">        </span><span class="NAME">dir</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="WHIT">
<span class='linenumber'>1188</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1189</span> 
<span class='linenumber'>1190</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.remoteSort</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1191</span> </span><span class="WHIT">        </span><span class="NAME">this.load</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1192</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1193</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sorters</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">sorters.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1194</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1195</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1196</span> 
<span class='linenumber'>1197</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sortFns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorters.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1198</span> 
<span class='linenumber'>1199</span> </span><span class="WHIT">        </span><span class="COMM">// create a sorter function for each sorter field/dir</span><span class="WHIT">
<span class='linenumber'>1200</span> </span><span class="WHIT">        </span><span class="COMM">// combo</span><span class="WHIT">
<span class='linenumber'>1201</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1202</span> </span><span class="WHIT">          </span><span class="NAME">sortFns.push</span><span class="PUNC">(</span><span class="NAME">this.createSortFunction</span><span class="PUNC">(</span><span class="NAME">sorters</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">field</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1203</span> </span><span class="WHIT">              </span><span class="NAME">sorters</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dir</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1204</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1205</span> 
<span class='linenumber'>1206</span> </span><span class="WHIT">        </span><span class="COMM">// the direction modifier is multiplied with the result of the</span><span class="WHIT">
<span class='linenumber'>1207</span> </span><span class="WHIT">        </span><span class="COMM">// sorting functions to provide overall sort direction</span><span class="WHIT">
<span class='linenumber'>1208</span> </span><span class="WHIT">        </span><span class="COMM">// (as opposed to direction per field)</span><span class="WHIT">
<span class='linenumber'>1209</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">directionModifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dir.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"DESC"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT">
<span class='linenumber'>1210</span> </span><span class="WHIT">            </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1211</span> 
<span class='linenumber'>1212</span> </span><span class="WHIT">        </span><span class="COMM">// create a function which ORs each sorter together to enable</span><span class="WHIT">
<span class='linenumber'>1213</span> </span><span class="WHIT">        </span><span class="COMM">// multi-sort</span><span class="WHIT">
<span class='linenumber'>1214</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1215</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sortFns</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1216</span> 
<span class='linenumber'>1217</span> </span><span class="WHIT">          </span><span class="COMM">// if we have more than one sorter, OR any additional sorter</span><span class="WHIT">
<span class='linenumber'>1218</span> </span><span class="WHIT">          </span><span class="COMM">// functions together</span><span class="WHIT">
<span class='linenumber'>1219</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sortFns.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1220</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sortFns.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1221</span> </span><span class="WHIT">              </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">sortFns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1222</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1223</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1224</span> 
<span class='linenumber'>1225</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">directionModifier</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1226</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1227</span> 
<span class='linenumber'>1228</span> </span><span class="WHIT">        </span><span class="NAME">this._data.sort</span><span class="PUNC">(</span><span class="NAME">dir</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1229</span> 
<span class='linenumber'>1230</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">suppressEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1231</span> </span><span class="WHIT">          </span><span class="NAME">this.fireEvent</span><span class="PUNC">(</span><span class="STRN">'datachanged'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._data.getArrayItems</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1232</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1233</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1234</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1235</span> 
<span class='linenumber'>1236</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1237</span>      * @private Creates and returns a function which sorts an array by
<span class='linenumber'>1238</span>      *          the given field and direction
<span class='linenumber'>1239</span>      * @param {String} field The field to create the sorter for
<span class='linenumber'>1240</span>      * @param {String} dir The direction to sort by (defaults to
<span class='linenumber'>1241</span>      *        "ASC")
<span class='linenumber'>1242</span>      * @return {Function} A function which sorts by the field/direction
<span class='linenumber'>1243</span>      *         combination provided
<span class='linenumber'>1244</span>      */</span><span class="WHIT">
<span class='linenumber'>1245</span> </span><span class="WHIT">    </span><span class="NAME">createSortFunction</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">field</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1246</span> </span><span class="WHIT">      </span><span class="NAME">dir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"ASC"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1247</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">directionModifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dir.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"DESC"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT">
<span class='linenumber'>1248</span> </span><span class="WHIT">          </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1249</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.model.prototype.fields</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sortType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sortType</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1250</span> 
<span class='linenumber'>1251</span> </span><span class="WHIT">      </span><span class="COMM">// create a comparison function. Takes 2 records, returns 1 if</span><span class="WHIT">
<span class='linenumber'>1252</span> </span><span class="WHIT">      </span><span class="COMM">// record 1 is greater,</span><span class="WHIT">
<span class='linenumber'>1253</span> </span><span class="WHIT">      </span><span class="COMM">// -1 if record 2 is greater or 0 if they are equal</span><span class="WHIT">
<span class='linenumber'>1254</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">r1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1255</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">v1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sortType</span><span class="PUNC">(</span><span class="NAME">r1._data</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sortType</span><span class="PUNC">(</span><span class="NAME">r2._data</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1256</span> 
<span class='linenumber'>1257</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">directionModifier</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v1</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">v2</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v1</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">v2</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1258</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1259</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1260</span> 
<span class='linenumber'>1261</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1262</span>      * TODO filter 처리해야함.
<span class='linenumber'>1263</span>      * @param {Boolean} suppressEvent If true, the 'datachanged' event
<span class='linenumber'>1264</span>      *        is not fired. Defaults to false
<span class='linenumber'>1265</span>      */</span><span class="WHIT">
<span class='linenumber'>1266</span> </span><span class="WHIT">    </span><span class="NAME">filter</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filters</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">suppressEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1267</span> </span><span class="WHIT">      </span><span class="NAME">this._opts.filters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filters</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._opts.filters</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1268</span> 
<span class='linenumber'>1269</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.remoteFilter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1270</span> </span><span class="WHIT">        </span><span class="COMM">// the read function will pick up the new filters and request</span><span class="WHIT">
<span class='linenumber'>1271</span> </span><span class="WHIT">        </span><span class="COMM">// the filtered data from the proxy</span><span class="WHIT">
<span class='linenumber'>1272</span> </span><span class="WHIT">        </span><span class="NAME">this.load</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1273</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1274</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='linenumber'>1275</span>          * A pristine (unfiltered) collection of the records in this store.
<span class='linenumber'>1276</span>          * This is used to reinstate records when a filter is removed or
<span class='linenumber'>1277</span>          * changed
<span class='linenumber'>1278</span>          * @property snapshot
<span class='linenumber'>1279</span>          */</span><span class="WHIT">
<span class='linenumber'>1280</span> </span><span class="WHIT">        </span><span class="NAME">this.snapshot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.snapshot</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._data</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1281</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1282</span> </span><span class="WHIT">        </span><span class="NAME">this._data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.snapshot</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._data</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>1283</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">filter</span><span class="PUNC">(</span><span class="NAME">this._opts.filters</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1284</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1285</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">suppressEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1286</span> </span><span class="WHIT">          </span><span class="NAME">this.fireEvent</span><span class="PUNC">(</span><span class="STRN">'datachanged'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._data.getArrayItems</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1287</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1288</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1289</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1290</span> 
<span class='linenumber'>1291</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1292</span>      * Revert to a view of the Record cache with no filtering applied.
<span class='linenumber'>1293</span>      * @param {Boolean} suppressEvent If &lt;tt>true&lt;/tt> the filter is
<span class='linenumber'>1294</span>      *        cleared silently without firing the &lt;code>datachanged&lt;/code>
<span class='linenumber'>1295</span>      *        event.
<span class='linenumber'>1296</span>      */</span><span class="WHIT">
<span class='linenumber'>1297</span> </span><span class="WHIT">    </span><span class="NAME">clearFilter</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">suppressEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1298</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isFiltered</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1299</span> </span><span class="WHIT">        </span><span class="NAME">this._data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.snapshot</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1300</span> </span><span class="WHIT">        </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.snapshot</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1301</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1302</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">suppressEvent</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1303</span> </span><span class="WHIT">          </span><span class="NAME">this.fireEvent</span><span class="PUNC">(</span><span class="STRN">'datachanged'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._data.getArrayItems</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1304</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1305</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1306</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1307</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1308</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1309</span>      * Returns true if this store is currently filtered
<span class='linenumber'>1310</span>      * @return {Boolean}
<span class='linenumber'>1311</span>      */</span><span class="WHIT">
<span class='linenumber'>1312</span> </span><span class="WHIT">    </span><span class="NAME">isFiltered</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1313</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">this.snapshot</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.snapshot</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this._data</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1314</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1315</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1316</span> </span><span class="WHIT">    </span><span class="COMM">// PAGING METHODS</span><span class="WHIT">
<span class='linenumber'>1317</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1318</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1319</span>      * Loads a given 'page' of data by setting the start and limit values appropriately
<span class='linenumber'>1320</span>      * @param {Number} page The number of the page to load
<span class='linenumber'>1321</span>      */</span><span class="WHIT">
<span class='linenumber'>1322</span> </span><span class="WHIT">    </span><span class="NAME">loadPage</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">page</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1323</span> </span><span class="WHIT">      </span><span class="NAME">this._currentPage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">page</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1324</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">returnVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.load</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1325</span> </span><span class="WHIT">          </span><span class="NAME">start</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">page</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this._opts.pageSize</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1326</span> </span><span class="WHIT">          </span><span class="NAME">limit</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this._opts.pageSize</span><span class="WHIT">
<span class='linenumber'>1327</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1328</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1329</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1330</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1331</span>      * Loads the next 'page' in the current data set
<span class='linenumber'>1332</span>      */</span><span class="WHIT">
<span class='linenumber'>1333</span> </span><span class="WHIT">    </span><span class="NAME">nextPage</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1334</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.loadPage</span><span class="PUNC">(</span><span class="NAME">this._currentPage</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1335</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1336</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1337</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1338</span>      * Loads the previous 'page' in the current data set
<span class='linenumber'>1339</span>      */</span><span class="WHIT">
<span class='linenumber'>1340</span> </span><span class="WHIT">    </span><span class="NAME">previousPage</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1341</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.loadPage</span><span class="PUNC">(</span><span class="NAME">this._currentPage</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1342</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1343</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1344</span> 
<span class='linenumber'>1345</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='linenumber'>1346</span> 
<span class='linenumber'>1347</span>    */</span><span class="WHIT">
<span class='linenumber'>1348</span> </span><span class="WHIT">  </span><span class="COMM">//----------------------------------------------------------------------------</span><span class="WHIT">
<span class='linenumber'>1349</span> </span><span class="WHIT">  </span><span class="COMM">/** @lends tau.data.Model */</span><span class="WHIT">
<span class='linenumber'>1350</span> </span><span class="WHIT">  </span><span class="NAME">$class</span><span class="PUNC">(</span><span class="STRN">'tau.data.Model'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">define</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1351</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1352</span>      * Constructor
<span class='linenumber'>1353</span>      * @class tau.data.Model definition goes here
<span class='linenumber'>1354</span>      * &lt;pre>&lt;code>
<span class='linenumber'>1355</span>      * tau.data.registerModel('User', [ 
<span class='linenumber'>1356</span>      *   {
<span class='linenumber'>1357</span>      *     name: 'name',
<span class='linenumber'>1358</span>      *     type: 'string'
<span class='linenumber'>1359</span>      *   },{
<span class='linenumber'>1360</span>      *     name: 'age',
<span class='linenumber'>1361</span>      *     type: 'int'
<span class='linenumber'>1362</span>      *   },{
<span class='linenumber'>1363</span>      *     name: 'phone',
<span class='linenumber'>1364</span>      *     type: 'string'
<span class='linenumber'>1365</span>      *   },{
<span class='linenumber'>1366</span>      *     name: 'alive',
<span class='linenumber'>1367</span>      *     type: 'boolean',
<span class='linenumber'>1368</span>      *     defaultValue: true
<span class='linenumber'>1369</span>      *   }
<span class='linenumber'>1370</span>      * ]};
<span class='linenumber'>1371</span>      * &lt;/code>&lt;/pre>
<span class='linenumber'>1372</span>      * 
<span class='linenumber'>1373</span>      * &lt;pre>&lt;code>
<span class='linenumber'>1374</span>      * var user = tau.data.getModelMgr.create( {
<span class='linenumber'>1375</span>      *   name: 'Ed',
<span class='linenumber'>1376</span>      *   age: 24,
<span class='linenumber'>1377</span>      *   phone: '555-555-5555'
<span class='linenumber'>1378</span>      * }, 'User');
<span class='linenumber'>1379</span>      * &lt;/code>&lt;/pre>
<span class='linenumber'>1380</span>      * @constructs
<span class='linenumber'>1381</span>      * @param data
<span class='linenumber'>1382</span>      * @param id
<span class='linenumber'>1383</span>      */</span><span class="WHIT">
<span class='linenumber'>1384</span> </span><span class="WHIT">    </span><span class="NAME">Model</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1385</span> 
<span class='linenumber'>1386</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>1387</span>        * Readonly flag - true if this Record has been modified.
<span class='linenumber'>1388</span>        */</span><span class="WHIT">
<span class='linenumber'>1389</span> </span><span class="WHIT">      </span><span class="NAME">this._dirty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1390</span> 
<span class='linenumber'>1391</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>1392</span>        * &lt;tt>true&lt;/tt> when the record does not yet exist in a server-side
<span class='linenumber'>1393</span>        * database (see {@link tau.data.Model.markDirty}). Any record which has a real
<span class='linenumber'>1394</span>        * database pk set as its id property is NOT a phantom -- it's real.
<span class='linenumber'>1395</span>        */</span><span class="WHIT">
<span class='linenumber'>1396</span> </span><span class="WHIT">      </span><span class="NAME">this._phantom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1397</span> 
<span class='linenumber'>1398</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>1399</span>        * Internal flag used to track whether or not the model instance is
<span class='linenumber'>1400</span>        * currently being edited. Read-only
<span class='linenumber'>1401</span>        */</span><span class="WHIT">
<span class='linenumber'>1402</span> </span><span class="WHIT">      </span><span class="NAME">this._editing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1403</span> 
<span class='linenumber'>1404</span> </span><span class="WHIT">      </span><span class="COMM">//add default field values if present</span><span class="WHIT">
<span class='linenumber'>1405</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fields</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1406</span> </span><span class="WHIT">          </span><span class="NAME">field</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1407</span> </span><span class="WHIT">          </span><span class="WHIT">
<span class='linenumber'>1408</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prop</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1409</span> </span><span class="WHIT">        </span><span class="NAME">field</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>1410</span> </span><span class="WHIT">        </span><span class="NAME">name</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">field.name</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1411</span> </span><span class="WHIT">        </span><span class="NAME">mapping</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">field.mapping</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1412</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='linenumber'>1413</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">tau.isUndefined</span><span class="PUNC">(</span><span class="NAME">mapping</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1414</span> </span><span class="WHIT">          </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">mapping</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">field.defaultValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1415</span> </span><span class="WHIT">          </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">mapping</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1416</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1417</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1418</span> </span><span class="WHIT">            </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">mapping</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">field.defaultValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1419</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1420</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1421</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1422</span> </span><span class="WHIT">      </span><span class="WHIT">
<span class='linenumber'>1423</span> </span><span class="WHIT">      </span><span class="NAME">this._data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1424</span> </span><span class="WHIT">      </span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="STRN">'id'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="STRN">'id'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">tau.genId</span><span class="PUNC">(</span><span class="STRN">'model'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1425</span> </span><span class="WHIT">      </span><span class="WHIT">
<span class='linenumber'>1426</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>1427</span>        * Key: value pairs of all fields whose values have changed
<span class='linenumber'>1428</span>        */</span><span class="WHIT">
<span class='linenumber'>1429</span> </span><span class="WHIT">      </span><span class="NAME">this.modified</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1430</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1431</span> 
<span class='linenumber'>1432</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1433</span>      * data가 변경되었을 경우 dirty flag, 수정된 사항을 저장한다.
<span class='linenumber'>1434</span>      */</span><span class="WHIT">
<span class='linenumber'>1435</span> </span><span class="WHIT">    </span><span class="NAME">markDirty</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1436</span> </span><span class="WHIT">      </span><span class="NAME">this._dirty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1437</span> </span><span class="WHIT">      </span><span class="NAME">this.modified</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.modified</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1438</span> </span><span class="WHIT">      </span><span class="NAME">this.fields.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1439</span> </span><span class="WHIT">        </span><span class="NAME">this.modified</span><span class="PUNC">[</span><span class="NAME">field.name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="NAME">field.name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1440</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1441</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1442</span> 
<span class='linenumber'>1443</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1444</span>      * Returns the unique ID allocated to this model instance as defined by
<span class='linenumber'>1445</span>      * @return {String} The id
<span class='linenumber'>1446</span>      */</span><span class="WHIT">
<span class='linenumber'>1447</span> </span><span class="WHIT">    </span><span class="NAME">getId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1448</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="STRN">'id'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1449</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1450</span> 
<span class='linenumber'>1451</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1452</span>      * Sets the model instance's id field to the given id
<span class='linenumber'>1453</span>      * @param {String} id The new id
<span class='linenumber'>1454</span>      */</span><span class="WHIT">
<span class='linenumber'>1455</span> </span><span class="WHIT">    </span><span class="NAME">setId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1456</span> </span><span class="WHIT">      </span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="STRN">'id'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1457</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1458</span> 
<span class='linenumber'>1459</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1460</span>      * Returns the value of the given field
<span class='linenumber'>1461</span>      * @param {String} field The field to fetch the value for
<span class='linenumber'>1462</span>      * @return {Object} The value
<span class='linenumber'>1463</span>      */</span><span class="WHIT">
<span class='linenumber'>1464</span> </span><span class="WHIT">    </span><span class="NAME">get</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1465</span> </span><span class="WHIT">      </span><span class="COMM">//tau.log('get : ' + field + '/ data :' + this._data[field], 1, this);</span><span class="WHIT">
<span class='linenumber'>1466</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1467</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1468</span> 
<span class='linenumber'>1469</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1470</span>      * Sets the given field to the given value, marks the instance as dirty
<span class='linenumber'>1471</span>      * @param {String} field The field to set
<span class='linenumber'>1472</span>      * @param {Object} value The value to set
<span class='linenumber'>1473</span>      */</span><span class="WHIT">
<span class='linenumber'>1474</span> </span><span class="WHIT">    </span><span class="NAME">set</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">field</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1475</span> </span><span class="WHIT">      </span><span class="NAME">this._dirty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1476</span> </span><span class="WHIT">      </span><span class="NAME">this.modified</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.modified</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1477</span> </span><span class="WHIT">      </span><span class="WHIT">
<span class='linenumber'>1478</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.modified</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1479</span> </span><span class="WHIT">        </span><span class="NAME">this.modified</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1480</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1481</span> </span><span class="WHIT">      </span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1482</span> 
<span class='linenumber'>1483</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._editing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1484</span> </span><span class="WHIT">        </span><span class="NAME">this._callDatasource</span><span class="PUNC">(</span><span class="STRN">'afterEdit'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1485</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1486</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1487</span> 
<span class='linenumber'>1488</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1489</span>      * Gets a hash of only the fields that have been modified since this
<span class='linenumber'>1490</span>      * Model was created or commited.
<span class='linenumber'>1491</span>      * @return Object
<span class='linenumber'>1492</span>      */</span><span class="WHIT">
<span class='linenumber'>1493</span> </span><span class="WHIT">    </span><span class="NAME">getChanges</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1494</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">modified</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.modified</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">changes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1495</span> 
<span class='linenumber'>1496</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">field</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">modified</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1497</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">modified.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">field</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1498</span> </span><span class="WHIT">          </span><span class="NAME">changes</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1499</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1500</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1501</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">changes</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1502</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1503</span> 
<span class='linenumber'>1504</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1505</span>      * Returns &lt;tt>true&lt;/tt> if the passed field name has been
<span class='linenumber'>1506</span>      * {@link tau.data.Model.modified} since the load or last commit.
<span class='linenumber'>1507</span>      * @param {String} field
<span class='linenumber'>1508</span>      * @return {Boolean}
<span class='linenumber'>1509</span>      */</span><span class="WHIT">
<span class='linenumber'>1510</span> </span><span class="WHIT">    </span><span class="NAME">isModified</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1511</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">this.modified</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.modified.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">field</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1512</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1513</span> 
<span class='linenumber'>1514</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1515</span>      * Begin an edit. While in edit mode, no events (e.g.. the &lt;code>update&lt;/code> event)
<span class='linenumber'>1516</span>      * are relayed to the containing datasource.
<span class='linenumber'>1517</span>      */</span><span class="WHIT">
<span class='linenumber'>1518</span> </span><span class="WHIT">    </span><span class="NAME">beginEdit</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1519</span> </span><span class="WHIT">      </span><span class="NAME">this.editing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1520</span> </span><span class="WHIT">      </span><span class="NAME">this.modified</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.modified</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1521</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1522</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1523</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>1524</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1525</span>      * data edit한 것을 취소
<span class='linenumber'>1526</span>      * @param {Boolean} silent (optional) True to skip notification of the
<span class='linenumber'>1527</span>      *        owning store of the change (defaults to false)
<span class='linenumber'>1528</span>      */</span><span class="WHIT">
<span class='linenumber'>1529</span> </span><span class="WHIT">    </span><span class="NAME">cancel</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">silent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1530</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">modified</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.modified</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1531</span> 
<span class='linenumber'>1532</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">field</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">modified</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1533</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">modified</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1534</span> </span><span class="WHIT">          </span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">modified</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1535</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1536</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1537</span> 
<span class='linenumber'>1538</span> </span><span class="WHIT">      </span><span class="NAME">this._dirty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1539</span> </span><span class="WHIT">      </span><span class="NAME">this._editing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1540</span> </span><span class="WHIT">      </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.modified</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1541</span> 
<span class='linenumber'>1542</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">silent</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1543</span> </span><span class="WHIT">        </span><span class="NAME">this._callDatasource</span><span class="PUNC">(</span><span class="STRN">'afterCancel'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1544</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1545</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1546</span> 
<span class='linenumber'>1547</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1548</span>      * edit한 data을 commit
<span class='linenumber'>1549</span>      * @param {Boolean} silent (optional) True to skip notification of the
<span class='linenumber'>1550</span>      *        owning store of the change (defaults to false)
<span class='linenumber'>1551</span>      */</span><span class="WHIT">
<span class='linenumber'>1552</span> </span><span class="WHIT">    </span><span class="NAME">commit</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">silent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1553</span> </span><span class="WHIT">      </span><span class="NAME">this._dirty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1554</span> </span><span class="WHIT">      </span><span class="NAME">this._editing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1555</span> 
<span class='linenumber'>1556</span> </span><span class="WHIT">      </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.modified</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1557</span> 
<span class='linenumber'>1558</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">silent</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1559</span> </span><span class="WHIT">        </span><span class="NAME">this._callDatasource</span><span class="PUNC">(</span><span class="STRN">'afterCommit'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1560</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1561</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1562</span> 
<span class='linenumber'>1563</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1564</span>      * Tells this model instance that it has been added to a Datasource
<span class='linenumber'>1565</span>      * @param {tau.data.Datasource} datasource The datasource that the model
<span class='linenumber'>1566</span>      *        has been added to
<span class='linenumber'>1567</span>      */</span><span class="WHIT">
<span class='linenumber'>1568</span> </span><span class="WHIT">    </span><span class="NAME">_join</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">datasource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1569</span> </span><span class="WHIT">      </span><span class="NAME">this._datasource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">datasource</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1570</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1571</span> 
<span class='linenumber'>1572</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1573</span>      * Tells this model instance that it has been removed from the
<span class='linenumber'>1574</span>      * Datasource
<span class='linenumber'>1575</span>      * @param {tau.data.Datasource} datasource The datasource to unjoin
<span class='linenumber'>1576</span>      */</span><span class="WHIT">
<span class='linenumber'>1577</span> </span><span class="WHIT">    </span><span class="NAME">_unjoin</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">datasource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1578</span> </span><span class="WHIT">      </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._datasource</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1579</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1580</span> 
<span class='linenumber'>1581</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>1582</span>      * Helper function used by afterEdit, afterCancel and afterCommit.
<span class='linenumber'>1583</span>      * @param {String} fn The function to call on the datasource
<span class='linenumber'>1584</span>      */</span><span class="WHIT">
<span class='linenumber'>1585</span> </span><span class="WHIT">    </span><span class="NAME">_callDatasource</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1586</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">datasource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._datasource</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1587</span> 
<span class='linenumber'>1588</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">tau.isUndefined</span><span class="PUNC">(</span><span class="NAME">datasource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>1589</span> </span><span class="WHIT">          </span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">datasource</span><span class="PUNC">[</span><span class="NAME">fn</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1590</span> </span><span class="WHIT">        </span><span class="NAME">datasource</span><span class="PUNC">[</span><span class="NAME">fn</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1591</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1592</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1593</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1594</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">;</span></pre></body></html>